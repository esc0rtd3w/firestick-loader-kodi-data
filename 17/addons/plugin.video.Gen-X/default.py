import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJlCmltcG9ydCBvcwppbXBvcnQgYmFzZTY0CmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBfRWRpdAoKTmZsID0gJycKRm9vdGJhbGwgPSAnJwpDcmlja2V0ID0gJycKVGVubmlzID0gJycgCkJveGluZyA9ICcnCkdvbGYgPSAnJwpNb3RvcnNwb3J0cyA9ICcnClJ1Z2J5ID0gJycKSG9ja2V5ID0gJycKTmJhID0gJycKRGFydHMgPSAnJwpXd2UgPSAnJwpIb3JzZV9SYWNpbmcgPSAnJwpVZmMgPSAnJwpCYXNlYmFsbCA9ICcnCgkKcmVzb2x2ZV91cmw9WycxZmljaGllci5jb20nLCAnMjRoZC5jbHViJywgJ2FsbGRlYnJpZC5jb20nLCAnYWxsbXl2aWRlb3MubmV0JywgJ2FsbHZpZC5jaCcsICdhdWVuZ2luZS5jb20nLCAnYmVzdHN0cmVhbXMubmV0JywgJ2JyaXNrZmlsZS5jb20nLCAnY2FzdGFtcC5jb20nLCAnY2xpY2tudXBsb2FkLmNvbScsICdjbGlja251cGxvYWQubWUnLCAnY2xpY2tudXBsb2FkLmxpbmsnLCAnY2xvdWR5LmVjJywgJ2Nsb3VkemlsbGEudG8nLCAnbmVvZHJpdmUuY28nLCAnY3J1bmNoeXJvbGwuY29tJywgJ2RhY2xpcHMuaW4nLCAnZGFjbGlwcy5jb20nLCAnZGFpbHltb3Rpb24uY29tJywgJ2RpdnhzdGFnZS5ldScsICdkaXZ4c3RhZ2UubmV0JywgJ2RpdnhzdGFnZS50bycsICdjb3VsZHRpbWUudG8nLCAnZWNvc3RyZWFtLnR2JywgJ2V4YXNoYXJlLmNvbScsICdlc3RyZWFtLnRvJywgJ2ZhY2Vib29rLmNvbScsICdmYXN0cGxheS5jYycsICdmYXN0cGxheS50bycsICdmYXN0cGxheS5zeCcsICdmaWxlaG9vdC5jb20nLCAnZmlsZW51a2UuY29tJywgJ2ZpbGVwdXAubmV0JywgJ2ZpbG1zaG93b25saW5lLm5ldCcsICdmbGFzaHgudHYnLCAncGx1cy5nb29nbGUuY29tJywgJ2dvb2dsZXZpZGVvLmNvbScsICdwaWNhc2F3ZWIuZ29vZ2xlLmNvbScsICdnb29nbGV1c2VyY29udGVudC5jb20nLCAnZ29vZ2xlZHJpdmUuY29tJywgJ2dvcmlsbGF2aWQuaW4nLCAnZ29yaWxsYXZpZC5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdncmlmdGhvc3QuY29tJywgJ2h1Z2VmaWxlcy5uZXQnLCAnaWRvd2F0Y2gubmV0JywgJ2luZGF2aWRlby5odScsICdpc2hhcmVkLmV1JywgJ2pldGxvYWQudHYnLCAna2luZ2ZpbGVzLm5ldCcsICdsZXR3YXRjaC51cycsICdsZXR3YXRjaC50bycsICd2aWRzaGFyZS51cycsICdtYWlsLnJ1JywgJ215Lm1haWwucnUnLCAndmlkZW9hcGkubXkubWFpbC5ydScsICdhcGkudmlkZW8ubWFpbC5ydScsICdtZWdhLWRlYnJpZC5ldScsICdtZWdhbXA0Lm5ldCcsICdtZXJzYWxhYXlpdHRlbi5jb20nLCAnbW92ZGl2eC5jb20nLCAnbW92cG9kLm5ldCcsICdtb3Zwb2QuaW4nLCAnbW92c2hhcmUubmV0JywgJ3dob2xlY2xvdWQubmV0JywgJ21wNGVuZ2luZS5jb20nLCAnbXA0c3RyZWFtLmNvbScsICdtcDR1cGxvYWQuY29tJywgJ215dmlkc3RyZWFtLm5ldCcsICdub3N2aWRlby5jb20nLCAnbm9zbG9ja2VyLmNvbScsICdhdXJvcmF2aWQudG8nLCAnbm92YW1vdi5jb20nLCAnbm93dmlkZW8uc3gnLCAnbm93dmlkZW8uZXUnLCAnbm93dmlkZW8uY2gnLCAnbm93dmlkZW8uc3gnLCAnbm93dmlkZW8uY28nLCAnbm93dmlkZW8ubGknLCAnbm93dmlkZW8uZWMnLCAnbm93dmlkZW8uYXQnLCAnbm93dmlkZW8uZm8nLCAnb2sucnUnLCAnb2Rub2tsYXNzbmlraS5ydScsICdvcGVubG9hZC5pbycsICdvcGVubG9hZC5jbycsICdwbGF5NDQubmV0JywgJ3BsYXllZC50bycsICdwbGF5aGQudmlkZW8nLCAncGxheWhkLmZvJywgJ3BsYXl1Lm5ldCcsICdwbGF5dS5tZScsICdwbGF5d2lyZS5jb20nLCAnUHJlbWl1bWl6ZS5tZScsICdwcmltZXNoYXJlLnR2JywgJ3Byb21wdGZpbGUuY29tJywgJ3B1cmV2aWQuY29tJywgJ3JhcGlkdmlkZW8ud3MnLCAncmFwaWR2aWRlby5jb20nLCAncmcudG8nLCAnYXBpLnJlYWwtZGVicmlkLmNvbScsICdwcmVtaXVtLnJwbmV0LmJpeicsICdydXR1YmUucnUnLCAnc2hhcmVkMi5tZScsICdzaGFyZWQuc3gnLCAnc2hhcmVyZXBvLmNvbScsICdzaGFyZXNpeC5jb20nLCAnc2ltcGx5LWRlYnJpZC5jb20nLCAnc3BlZWRwbGF5Lnh5eicsICdzcGVlZHBsYXkudXMnLCAnc3BlZWRwbGF5My5wdycsICdzcGVlZHZpZGVvLm5ldCcsICdzdGFnZXZ1LmNvbScsICdzdHJlYW1jbG91ZC5ldScsICdzdHJlYW1pbi50bycsICdzdHJlYW0ubW9lJywgJ3N0cmVhbWFuZ28uY29tJywgJ3N0cmVhbWNoZXJyeS5jb20nLCAndGVyYW1peGVyLmNvbScsICd0aGV2aWRlby5tZScsICd0aGV2aWQubmV0JywgJ3RoZXZpZGVvcy50dicsICd0b2x0c2QtZmVsLnRrJywgJ3Ryb2xsdmlkLm5ldCcsICd0dW5lLnBrJywgJ3R1c2ZpbGVzLm5ldCcsICd0d2l0Y2gudHYnLCAndXAyc3RyZWFtLmNvbScsICd1cGxvYWQuYWYnLCAndXBsb2FkYy5jb20nLCAndXBsb2FkYy5jaCcsICd6YWxhYS5jb20nLCAndXBsb2FkeC5vcmcnLCAndXB0b2JveC5jb20nLCAndXB0b3N0cmVhbS5jb20nLCAndXNlcmZpbGVzLmNvbScsICd1c2Vyc2Nsb3VkLmNvbScsICd2ZWVoZC5jb20nLCAndmVvaC5jb20nLCAndmlkLmFnJywgJ3ZpZGJ1bGwuY29tJywgJ3ZpZGNyYXp5Lm5ldCcsICd1cGxvYWRjcmF6eS5uZXQnLCAndGhldmlkZW9iZWUudG8nLCAndmlkZW9ib3hlci5jbycsICd2aWRnZy50bycsICd2aWQuZ2cnLCAndmlkZW9odXQudG8nLCAndmlkZW9tZWdhLnR2JywgJ3ZpZGVvcmFqLnRvJywgJ3ZpZGVvcmV2LmNjJywgJ3ZpZGVvc2t5LnRvJywgJ3ZpZGVvLnR0JywgJ3ZpZGVvd2VlZC5lcycsICdiaXR2aWQuc3gnLCAndmlkZW93ZWVkLmNvbScsICd2aWRlb3dvb2QudHYnLCAnYnl6b28ub3JnJywgJ3BsYXlwYW5kYS5uZXQnLCAndmlkZW96b28ubWUnLCAndmlkZW93aW5nLm1lJywgJ3ZpZGVvd2luZy5tZScsICdlYXN5dmlkZW8ubWUnLCAncGxheTQ0Lm5ldCcsICdwbGF5YmIubWUnLCAndmlkZW80NC5uZXQnLCAndmlkaW8uc3gnLCAndmlkbG94Lm1lJywgJ3ZpZC5tZScsICd2aWRzcG90Lm5ldCcsICd2aWR0by5tZScsICd2aWR1cC5tZScsICd2aWR1cC5vcmcnLCAndmlkemkudHYnLCAndmltZW8uY29tJywgJ3Zpdm8uc3gnLCAndmsuY29tJywgJ3ZrcGFzcy5jb20nLCAndm9kbG9ja2VyLmNvbScsICd2c2hhcmUuaW8nLCAndnNoYXJlLmV1JywgJ3dhdGNoZXJzLnRvJywgJ3dhdGNob25saW5lLnRvJywgJ3dhdGNodmlkZW8udXMnLCAnd2F0Y2h2aWRlbzIudXMnLCAnd2F0Y2h2aWRlbzMudXMnLCAnd2F0Y2h2aWRlbzQudXMnLCAnd2F0Y2h2aWRlbzUudXMnLCAnd2F0Y2h2aWRlbzYudXMnLCAnd2F0Y2h2aWRlbzcudXMnLCAnd2F0Y2h2aWRlbzgudXMnLCAnd2F0Y2h2aWRlbzkudXMnLCAnd2VzaGFyZS5tZScsICd4dmlkc3RhZ2UuY29tJywgJ3lvdWxvbC5iaXonLCAnc2hpdG1vdmllLmNvbScsICd5b3VydXBsb2FkLmNvbScsICd5b3V0dWJlLmNvbScsICd5b3V0dS5iZScsICd5b3V3YXRjaC5vcmcnLCAnYXBpLnpldmVyYS5jb20nLCAnemV0dGFob3N0LnR2JywgJ3pzdHJlYW0udG8nXQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10KCmNsYXNzIE5vUmVkaXJlY3Rpb24odXJsbGliMi5IVFRQRXJyb3JQcm9jZXNzb3IpOgogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgaHR0cHNfcmVzcG9uc2UgPSBodHRwX3Jlc3BvbnNlCiAgICAgICAKYWRkb24gPSBfRWRpdC5hZGRvbgphZGRvbl92ZXJzaW9uID0gYWRkb24uZ2V0QWRkb25JbmZvKCd2ZXJzaW9uJykKcHJvZmlsZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3Byb2ZpbGUnKS5kZWNvZGUoJ3V0Zi04JykpCmhvbWUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwYXRoJykuZGVjb2RlKCd1dGYtOCcpKQpmYXZvcml0ZXMgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2Zhdm9yaXRlcycpCmhpc3RvcnkgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2hpc3RvcnknKQoKUkVWID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdsaXN0X3JldmlzaW9uJykKaWNvbiA9IG9zLnBhdGguam9pbihob21lLCAnaWNvbi5wbmcnKQpGQU5BUlQgPSBvcy5wYXRoLmpvaW4oaG9tZSwgJ2ZhbmFydC5qcGcnKQpzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnc291cmNlX2ZpbGUnKQpmdW5jdGlvbnNfZGlyID0gcHJvZmlsZQpkZWJ1ZyA9IGFkZG9uLmdldFNldHRpbmcoJ2RlYnVnJykKaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09VHJ1ZToKICAgIEZBViA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkKZWxzZTogRkFWID0gW10KaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOgogICAgU09VUkNFUyA9IG9wZW4oc291cmNlX2ZpbGUpLnJlYWQoKQplbHNlOiBTT1VSQ0VTID0gW10KCgpkZWYgYWRkb25fbG9nKHN0cmluZyk6CiAgICBpZiBkZWJ1ZyA9PSAndHJ1ZSc6CiAgICAgICAgeGJtYy5sb2coIlthZGRvbi5saXZlLkdlbi1YIExpc3RzLSVzXTogJXMiICUoYWRkb25fdmVyc2lvbiwgc3RyaW5nKSkKCgpkZWYgbWFrZVJlcXVlc3QodXJsLCBoZWFkZXJzPU5vbmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgaGVhZGVycyBpcyBOb25lOgogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnVXNlci1hZ2VudCcgOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgcnY6MTkuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xOS4wJ30KICAgICAgICAgICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCxOb25lLGhlYWRlcnMpCiAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZXhjZXB0IHVybGxpYjIuVVJMRXJyb3IsIGU6CiAgICAgICAgICAgIGFkZG9uX2xvZygnVVJMOiAnK3VybCkKICAgICAgICAgICAgaWYgaGFzYXR0cihlLCAnY29kZScpOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gJXMuJyAlIGUuY29kZSkKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEdlbi1YLFdlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAiK3N0cihlLmNvZGUpKyIsMTAwMDAsIitpY29uKyIpIikKICAgICAgICAgICAgZWxpZiBoYXNhdHRyKGUsICdyZWFzb24nKToKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLicpCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1JlYXNvbjogJXMnICVlLnJlYXNvbikKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEdlbi1YLFdlIGZhaWxlZCB0byByZWFjaCBhIHNlcnZlci4gLSAiK3N0cihlLnJlYXNvbikrIiwxMDAwMCwiK2ljb24rIikiKQoKCQkJCQpkZWYgU0tpbmRleCgpOgogICAgYWRkb25fbG9nKCJTS2luZGV4IikKICAgIGdldERhdGEoX0VkaXQuTWFpbkJhc2UsJycpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgkJCmRlZiBPcGVuX1VybCh1cmwpOgogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkKICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzOyBVOyBXaW5kb3dzIE5UIDUuMTsgZW4tR0I7IHJ2OjEuOS4wLjMpIEdlY2tvLzIwMDgwOTI0MTcgRmlyZWZveC8zLjAuMycpCiAgICByZXNwb25zZSA9ICcnCiAgICBsaW5rID0gJycKICAgIHRyeTogCiAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgICAgIGxpbms9cmVzcG9uc2UucmVhZCgpCiAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQogICAgZXhjZXB0OiBwYXNzCiAgICBpZiBsaW5rICE9ICcnOgogICAgICAgIHJldHVybiBsaW5rCiAgICBlbHNlOgogICAgICAgIGxpbmsgPSAnT3BlbmVkJwogICAgICAgIHJldHVybiBsaW5rCgkKZGVmIFNlYXJjaF9pbnB1dCh1cmwpOgogICAgRGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgU2VhcmNoX3RpdGxlID0gRGlhbG9nLmlucHV0KCdTZWFyY2gnLCB0eXBlPXhibWNndWkuSU5QVVRfQUxQSEFOVU0pCiAgICBTZWFyY2hfbmFtZSA9IFNlYXJjaF90aXRsZS5sb3dlcigpCiAgICBpZiBTZWFyY2hfbmFtZSA9PSAnJzoKICAgICAgICBwYXNzCiAgICBlbHNlOgogICAgICAgIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCkgICAgCgkKZGVmIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCk6CiAgICBIVE1MID0gT3Blbl9VcmwodXJsKQogICAgaWYgSFRNTCAhPSAnRmFpbGVkJzoKICAgICAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJzxjaGFubmVsPi4rPzxuYW1lPiguKz8pPC9uYW1lPi4rPzx0aHVtYm5haWw+KC4rPyk8L3RodW1ibmFpbD4uKz88ZXh0ZXJuYWxsaW5rPiguKz8pPC9leHRlcm5hbGxpbms+Lis/PGZhbmFydD4oLis/KTwvZmFuYXJ0Pi4rPzwvY2hhbm5lbD4nLHJlLkRPVEFMTCkuZmluZGFsbChIVE1MKQogICAgICAgIGZvciBuYW1lLGltYWdlLHVybCxmYW5hcnQgaW4gbWF0Y2g6CiAgICAgICAgICAgIGlmIG5vdCAnaHR0cDonIGluIHVybDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCkKICAgICAgICBtYXRjaDIgPSByZS5jb21waWxlKCc8dGl0bGU+KC4rPyk8L3RpdGxlPi4rPzxsaW5rPiguKz8pPC9saW5rPi4rPzx0aHVtYm5haWw+KC4rPyk8L3RodW1ibmFpbD4uKz88ZmFuYXJ0PiguKz8pPC9mYW5hcnQ+JyxyZS5ET1RBTEwpLmZpbmRhbGwoSFRNTCkKICAgICAgICBmb3IgbmFtZSx1cmwsaW1hZ2UsZmFuYXJ0IGluIG1hdGNoMjoKICAgICAgICAgICAgaWYgJ2h0dHA6JyBpbiB1cmw6CiAgICAgICAgICAgICAgICBpZiBTZWFyY2hfbmFtZS5sb3dlcigpIGluIG5hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCwgbmFtZSxpbWFnZSxmYW5hcnQsJycsJycsJycsJycsTm9uZSwnJywxKQoJCQoJCQpkZWYgZ2V0U291cmNlcygpOgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcykgPT0gVHJ1ZToKICAgICAgICAgICAgYWRkRGlyKCdGYXZvcml0ZXMnLCd1cmwnLDQsb3MucGF0aC5qb2luKGhvbWUsICdyZXNvdXJjZXMnLCAnZmF2b3JpdGUucG5nJyksRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV94bWxfZGF0YWJhc2UiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignWE1MIERhdGFiYXNlJywnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycsMTUsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiYnJvd3NlX2NvbW11bml0eSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdDb21tdW5pdHkgRmlsZXMnLCdjb21tdW5pdHlfZmlsZXMnLDE2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGhpc3RvcnkpID09IFRydWU6CiAgICAgICAgICAgIGFkZERpcignU2VhcmNoIEhpc3RvcnknLCdoaXN0b3J5JywyNSxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygic2VhcmNoeXQiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignU2VhcmNoOllvdXR1YmUnLCd5b3V0dWJlJywyNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJzZWFyY2hETSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2g6ZGFpbHltb3Rpb24nLCdkbW90aW9uJywyNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJQdWxzYXJNIikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ1B1bHNhcjpJTURCJywnSU1EQmlkcGxheScsMjcsaWNvbixGQU5BUlQsJycsJycsJycsJycpICAgICAgICAgICAgCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOgogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgICAgICAjcHJpbnQgJ3NvdXJjZXMnLHNvdXJjZXMKICAgICAgICAgICAgaWYgbGVuKHNvdXJjZXMpID4gMToKICAgICAgICAgICAgICAgIGZvciBpIGluIHNvdXJjZXM6CiAgICAgICAgICAgICAgICAgICAgIyMgZm9yIHByZSAxLjAuOCBzb3VyY2VzCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKGlbMF0uZW5jb2RlKCd1dGYtOCcpLGlbMV0uZW5jb2RlKCd1dGYtOCcpLDEsaWNvbixGQU5BUlQsJycsJycsJycsJycsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpY29uCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IEZBTkFSVAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgndGh1bWJuYWlsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IGlbJ3RodW1ibmFpbCddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpWydmYW5hcnQnXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2Rlc2NyaXB0aW9uJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gaVsnZGVzY3JpcHRpb24nXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2RhdGUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSBpWydkYXRlJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdnZW5yZScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBpWydnZW5yZSddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnY3JlZGl0cycpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9IGlbJ2NyZWRpdHMnXQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVsndGl0bGUnXS5lbmNvZGUoJ3V0Zi04JyksaVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWIsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLCdzb3VyY2UnKQoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA9PSAxOgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1swXSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsxXS5lbmNvZGUoJ3V0Zi04JyksRkFOQVJUKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsndXJsJ10sIHNvdXJjZXNbMF1bJ2ZhbmFydCddKQoKCmRlZiBhZGRTb3VyY2UodXJsPU5vbmUpOgogICAgICAgIGlmIHVybCBpcyBOb25lOgogICAgICAgICAgICBpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X2ZpbGVfc291cmNlIikgPT0gIiI6CiAgICAgICAgICAgICAgIHNvdXJjZV91cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X3VybF9zb3VyY2UiKSA9PSAiIjoKICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld191cmxfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlX3VybCA9IHVybAogICAgICAgIGlmIHNvdXJjZV91cmwgPT0gJycgb3Igc291cmNlX3VybCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBhZGRvbl9sb2coJ0FkZGluZyBOZXcgU291cmNlOiAnK3NvdXJjZV91cmwuZW5jb2RlKCd1dGYtOCcpKQoKICAgICAgICBtZWRpYV9pbmZvID0gTm9uZQogICAgICAgICNwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybAogICAgICAgIGRhdGEgPSBnZXRTb3VwKHNvdXJjZV91cmwpCiAgICAgICAgcHJpbnQgJ3NvdXJjZV91cmwnLHNvdXJjZV91cmwKICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsQmVhdXRpZnVsU09BUCk6CiAgICAgICAgICAgIGlmIGRhdGEuZmluZCgnY2hhbm5lbHNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuY2hhbm5lbHNfaW5mbwogICAgICAgICAgICBlbGlmIGRhdGEuZmluZCgnaXRlbXNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuaXRlbXNfaW5mbwogICAgICAgIGlmIG1lZGlhX2luZm86CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aXRsZSddID0gbWVkaWFfaW5mby50aXRsZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aHVtYm5haWwnXSA9IG1lZGlhX2luZm8udGh1bWJuYWlsLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gbWVkaWFfaW5mby5mYW5hcnQuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZ2VucmUnXSA9IG1lZGlhX2luZm8uZ2VucmUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGVzY3JpcHRpb24nXSA9IG1lZGlhX2luZm8uZGVzY3JpcHRpb24uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGF0ZSddID0gbWVkaWFfaW5mby5kYXRlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2NyZWRpdHMnXSA9IG1lZGlhX2luZm8uY3JlZGl0cy5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgJy8nIGluIHNvdXJjZV91cmw6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnLycpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICdcXCcgaW4gc291cmNlX3VybDoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCdcXCcpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICclJyBpbiBuYW1lU3RyOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHVybGxpYi51bnF1b3RlX3BsdXMobmFtZVN0cikKICAgICAgICAgICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKG5hbWVTdHIsJ0Rpc3BsYXllZCBOYW1lLCBSZW5hbWU/JykKICAgICAgICAgICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICAgICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBuZXdTdHIgPSBrZXlib2FyZC5nZXRUZXh0KCkKICAgICAgICAgICAgaWYgbGVuKG5ld1N0cikgPT0gMDoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBzb3VyY2VfbWVkaWEgPSB7fQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBuZXdTdHIKICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwKICAgICAgICAgICAgc291cmNlX21lZGlhWydmYW5hcnQnXSA9IGZhbmFydAoKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PUZhbHNlOgogICAgICAgICAgICBzb3VyY2VfbGlzdCA9IFtdCiAgICAgICAgICAgIHNvdXJjZV9saXN0LmFwcGVuZChzb3VyY2VfbWVkaWEpCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZV9saXN0KSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICAgICAgc291cmNlcy5hcHBlbmQoc291cmNlX21lZGlhKQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnLCAiIikKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnLCAiIikKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihHZW4tWCxOZXcgc291cmNlIGFkZGVkLiw1MDAwLCIraWNvbisiKSIpCiAgICAgICAgaWYgbm90IHVybCBpcyBOb25lOgogICAgICAgICAgICBpZiAneGJtY3BsdXMueGIuZnVucGljLmRlJyBpbiB1cmw6CiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xNCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQogICAgICAgICAgICBlbGlmICdjb21tdW5pdHktbGlua3MnIGluIHVybDoKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTEwLHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pCiAgICAgICAgZWxzZTogYWRkb24ub3BlblNldHRpbmdzKCkKCQoKZGVmIHJtU291cmNlKG5hbWUpOgogICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihzb3VyY2VzKSk6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1tpbmRleF0sIGxpc3QpOgogICAgICAgICAgICAgICAgaWYgc291cmNlc1tpbmRleF1bMF0gPT0gbmFtZToKICAgICAgICAgICAgICAgICAgICBkZWwgc291cmNlc1tpbmRleF0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVsndGl0bGUnXSA9PSBuYW1lOgogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikKCgoKZGVmIGdldF94bWxfZGF0YWJhc2UodXJsLCBicm93c2U9RmFsc2UpOgogICAgICAgIGlmIHVybCBpcyBOb25lOgogICAgICAgICAgICB1cmwgPSAnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycKICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQogICAgICAgIGZvciBpIGluIHNvdXAoJ2EnKToKICAgICAgICAgICAgaHJlZiA9IGlbJ2hyZWYnXQogICAgICAgICAgICBpZiBub3QgaHJlZi5zdGFydHN3aXRoKCc/Jyk6CiAgICAgICAgICAgICAgICBuYW1lID0gaS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIG5hbWUgbm90IGluIFsnUGFyZW50IERpcmVjdG9yeScsICdyZWN5Y2xlX2Jpbi8nXToKICAgICAgICAgICAgICAgICAgICBpZiBocmVmLmVuZHN3aXRoKCcvJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE1LGljb24sZmFuYXJ0LCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTQsaWNvbixmYW5hcnQsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBocmVmLmVuZHN3aXRoKCcueG1sJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuYW1lIGluIFNPVVJDRVM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lKycgKGluIHVzZSknLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKCgpkZWYgZ2V0Q29tbXVuaXR5U291cmNlcyhicm93c2U9RmFsc2UpOgogICAgICAgIHVybCA9ICdodHRwOi8vY29tbXVuaXR5LWxpbmtzLmdvb2dsZWNvZGUuY29tL3N2bi90cnVuay8nCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykKICAgICAgICBmaWxlcyA9IHNvdXAoJ3VsJylbMF0oJ2xpJylbMTpdCiAgICAgICAgZm9yIGkgaW4gZmlsZXM6CiAgICAgICAgICAgIG5hbWUgPSBpKCdhJylbMF1bJ2hyZWYnXQogICAgICAgICAgICBpZiBicm93c2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQoKCmRlZiBnZXRTb3VwKHVybCxkYXRhPU5vbmUpOgogICAgICAgIHByaW50ICdnZXRzb3VwJyx1cmwsZGF0YQogICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCdodHRwOi8vJykgb3IgdXJsLnN0YXJ0c3dpdGgoJ2h0dHBzOi8vJyk6CiAgICAgICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpCiAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgiI0VYVE0zVSIsZGF0YSkgb3IgJ20zdScgaW4gdXJsOiAKICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScsZGF0YQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgICAgIAogICAgICAgIGVsaWYgZGF0YSA9PSBOb25lOgogICAgICAgICAgICBpZiB4Ym1jdmZzLmV4aXN0cyh1cmwpOgogICAgICAgICAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoInNtYjovLyIpIG9yIHVybC5zdGFydHN3aXRoKCJuZnM6Ly8iKToKICAgICAgICAgICAgICAgICAgICBjb3B5ID0geGJtY3Zmcy5jb3B5KHVybCwgb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpCiAgICAgICAgICAgICAgICAgICAgaWYgY29weToKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4ob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JyksICJyIikucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWN2ZnMuZGVsZXRlKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiZmFpbGVkIHRvIGNvcHkgZnJvbSBzbWI6IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4odXJsLCAncicpLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGlmIHJlLm1hdGNoKCIjRVhUTTNVIixkYXRhKW9yICdtM3UnIGluIHVybDogCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScsZGF0YQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCJTb3VwIERhdGEgbm90IGZvdW5kISIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICByZXR1cm4gQmVhdXRpZnVsU09BUChkYXRhLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU3RvbmVTb3VwLlhNTF9FTlRJVElFUykKCgpkZWYgZ2V0RGF0YSh1cmwsZmFuYXJ0KToKICAgIHByaW50ICd1cmwtZ2V0RGF0YScsdXJsCiAgICBTZXRWaWV3TGF5b3V0ID0gIkxpc3QiCiAgICAgCiAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAjcHJpbnQgdHlwZShzb3VwKQogICAgaWYgaXNpbnN0YW5jZShzb3VwLEJlYXV0aWZ1bFNPQVApOgogICAgICAgIGlmIGxlbihzb3VwKCdsYXlvdXR5cGUnKSkgPiAwOgogICAgICAgICAgICBTZXRWaWV3TGF5b3V0ID0gIlRodW1ibmFpbCIJCSAgICAKCiAgICAgICAgaWYgbGVuKHNvdXAoJ2NoYW5uZWxzJykpID4gMDoKICAgICAgICAgICAgY2hhbm5lbHMgPSBzb3VwKCdjaGFubmVsJykKICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbHM6CiMgICAgICAgICAgICAgICAgcHJpbnQgY2hhbm5lbAoKICAgICAgICAgICAgICAgIGxpbmtlZFVybD0nJwogICAgICAgICAgICAgICAgbGNvdW50PTAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBsaW5rZWRVcmwgPSAgY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgbGNvdW50PWxlbihjaGFubmVsKCdleHRlcm5hbGxpbmsnKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgI3ByaW50ICdsaW5rZWRVcmwnLGxpbmtlZFVybCxsY291bnQKICAgICAgICAgICAgICAgIGlmIGxjb3VudD4xOiBsaW5rZWRVcmw9JycKCiAgICAgICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgbGlua2VkVXJsPT0nJzoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDIsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsY3JlZGl0cyxUcnVlKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgPT0gJ1tDT0xPUiByZWRdTGl2ZSBTcG9ydFsvQ09MT1JdJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxsaW5rZWRVcmwuZW5jb2RlKCd1dGYtOCcpLDMxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgkJCQkJCSAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksbGlua2VkVXJsLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgZnJvbSBnZXREYXRhKCk6ICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZygnTm8gQ2hhbm5lbHM6IGdldEl0ZW1zJykKICAgICAgICAgICAgZ2V0SXRlbXMoc291cCgnaXRlbScpLGZhbmFydCkKICAgIGVsc2U6CiAgICAgICAgcGFyc2VfbTN1KHNvdXApCgogICAgaWYgU2V0Vmlld0xheW91dCA9PSAiVGh1bWJuYWlsIjoKICAgICAgIFNldFZpZXdUaHVtYm5haWwoKQoJICAgCmRlZiBXaXpIRE1lbnUodXJsLGljb25pbWFnZSxmYW5hcnQpOgoJYWRkRGlyKCdHZW4tWFBsYXlsaXN0ZWQnLHVybCwxLGljb25pbWFnZSxmYW5hcnQsJycsJycsJycsTm9uZSwnc291cmNlJykKCWh0bWwgPSByZXF1ZXN0cy5nZXQoJ2h0dHA6Ly93aXpoZHNwb3J0cy5pcy8nKS5jb250ZW50CglibG9jayA9IHJlLmNvbXBpbGUoJzx1bCBjbGFzcz0ic3BvcnRzX21lbnUiPiguKz8pPC91bD4nLHJlLkRPVEFMTCkuZmluZGFsbChodG1sKQoJZm9yIGl0ZW0gaW4gYmxvY2s6CgkJbWF0Y2ggPSByZS5jb21waWxlKCc8YSBocmVmPSIoLis/KSIuKz9zcmM9IiguKz8pIi4rPz4gKC4rPyk8L2xpPicpLmZpbmRhbGwoc3RyKGl0ZW0pKQoJCWZvciB1cmwyLGljb25pbWFnZSxuYW1lIGluIG1hdGNoOgoJCQluYW1lID0gbmFtZS50aXRsZSgpCgkJCWlmIG5hbWUgPT0gJ05mbCc6aW1hZ2UgPSBOZmwKCQkJZWxpZiBuYW1lID09ICdGb290YmFsbCc6aW1hZ2UgPSBGb290YmFsbAoJCQllbGlmIG5hbWUgPT0gJ0NyaWNrZXQnOmltYWdlID0gQ3JpY2tldAoJCQllbGlmIG5hbWUgPT0gJ1Rlbm5pcyc6aW1hZ2UgPSBUZW5uaXMKCQkJZWxpZiBuYW1lID09ICdCb3hpbmcnOmltYWdlID0gQm94aW5nCgkJCWVsaWYgbmFtZSA9PSAnR29sZic6aW1hZ2UgPSBHb2xmCgkJCWVsaWYgbmFtZSA9PSAnTW90b3Nwb3J0cyc6aW1hZ2UgPSBNb3RvcnNwb3J0cwoJCQllbGlmIG5hbWUgPT0gJ1J1Z2J5JzppbWFnZSA9IFJ1Z2J5CgkJCWVsaWYgbmFtZSA9PSAnSG9ja2V5JzppbWFnZSA9IEhvY2tleQoJCQllbGlmIG5hbWUgPT0gJ05iYSc6aW1hZ2UgPSBOYmEKCQkJZWxpZiBuYW1lID09ICdEYXJ0cyc6aW1hZ2UgPSBEYXJ0cwoJCQllbGlmIG5hbWUgPT0gJ1d3ZSc6aW1hZ2UgPSBXd2UKCQkJZWxpZiBuYW1lID09ICdIb3JzZSBSYWNpbmcnOmltYWdlID0gSG9yc2VfUmFjaW5nCgkJCWVsaWYgbmFtZSA9PSAnVWZjJzppbWFnZSA9IFVmYwoJCQllbGlmIG5hbWUgPT0gJ0Jhc2ViYWxsJzppbWFnZSA9IEJhc2ViYWxsCgkJCWlmIG5hbWUgPT0gJ1R2IFNob3dzJzpwYXNzCgkJCWVsaWYgbmFtZSA9PSAnT3RoZXJzJzpwYXNzCgkJCWVsaWYgbmFtZSA9PSAnUDJQIE9ubGluZSc6cGFzcwoJCQllbHNlOgoJCQkJaWYgaW1hZ2UgPT0gJyc6CgkJCQkJaW1hZ2UgPSBpY29uaW1hZ2UKCQkJCWFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmwyLmVuY29kZSgndXRmLTgnKSwzMixpbWFnZSxmYW5hcnQsJycsJycsJycsTm9uZSwnc291cmNlJykKCQkJCQpkZWYgV2l6X0dldF91cmwodXJsKToKCUxpc3QgPSBbXQoKCWZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCgl0b2RheXNfZGF5ID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVkJykKCXRvZGF5c19tb250aCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclbScpCgl0b2RheXNfeWVhciA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWScpCgl0b2RheXNfaG91ciA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSCcpCgl0b2RheXNfbWludXRlID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVNJykKCWZpbl9kYXRlID0gdG9kYXlzX2RheSsnLScrdG9kYXlzX21vbnRoKyctJyt0b2RheXNfeWVhcgoJaHRtbCA9IHJlcXVlc3RzLmdldCh1cmwpLmNvbnRlbnQKCWJsb2NrID0gcmUuY29tcGlsZSgnPGgzPi4rP0dhbWVzIE9uIDogKC4rPyk8L2gzPiguKz8pPGxpIGNsYXNzPVwnc3BvcnRzX3JlZF9iYXJcJz4nLHJlLkRPVEFMTCkuZmluZGFsbChodG1sKQoJZm9yIGRhdGUscmVzdCBpbiBibG9jazoKCQlpZiBkYXRlID09IGZpbl9kYXRlOgoJCQltYXRjaCA9IHJlLmNvbXBpbGUoJzxkaXYgY2xhc3M9XCdjb2wtbWQtMlwnPi4rPzwvc3Bhbj4oLis/KTwvZGl2Pi4rPzxkaXYgY2xhc3M9XCdjb2wtbWQtNlwnPiguKz8pPC9kaXY+Lis/ZGl2IGNsYXNzPSJjYXJkLWJsb2NrIGRyb3BfYm94Ij4oLis/KTxkaXYgY2xhc3M9ImNhcmQiPicscmUuRE9UQUxMKS5maW5kYWxsKHN0cihyZXN0KSkKCQkJZm9yIHRpbWUsdGVhbXMsbGlua19ibG9jayBpbiBtYXRjaDoKCQkJCXRvdGFsID0gbGVuKG1hdGNoKQoJCQkJdGVhbXMgPSB0ZWFtcy5yZXBsYWNlKCcgICcsJycpLnJlcGxhY2UoJwknLCcnKQoJCQkJbGlua19ibG9jayA9IGxpbmtfYmxvY2sucmVwbGFjZSgnICAnLCcnKQoJCQkJdGltZV9zcGxpdCA9IHJlLmZpbmRhbGwoJyguKz8pOiguKz8pLSguKz8pOiguKz8pPicsc3RyKHRpbWUrJz4nKSkKCQkJCWZvciBzdGFydF9ob3VyLHN0YXJ0X21pbixmaW5faG91cixmaW5fbWluIGluIHRpbWVfc3BsaXQ6CgkJCQkJc3RhcnRfbm8gPSBpbnQoc3RhcnRfaG91cikqMjQraW50KHN0YXJ0X21pbikKCQkJCQlmaW5fbm8gPSBpbnQoZmluX2hvdXIpKjI0K2ludChmaW5fbWluKQoJCQkJCXRpbWVfbm93ID0gaW50KHRvZGF5c19ob3VyKSoyNCtpbnQodG9kYXlzX21pbnV0ZSkKCQkJCQlpZiBmaW5fbm8+dGltZV9ub3c+c3RhcnRfbm86CgkJCQkJCW5hbWUgPSAnW0NPTE9SZ3JlZW5dJysgdGVhbXMrJ1svQ09MT1JdJwoJCQkJCWVsc2U6CgkJCQkJCW5hbWUgPSB0ZWFtcwoJCQkJbGlua19nZXQgPSByZS5jb21waWxlKCI8YSBocmVmPScoLis/KSc+Lis/PiguKz8pPC9kaXY+PC9hPiIpLmZpbmRhbGwoc3RyKGxpbmtfYmxvY2spKQoJCQkJZm9yIGxpbmssY2hubCBpbiBsaW5rX2dldDoKCQkJCQlsaW5rID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5TcG9ydHNEZXZpbC8/bW9kZT0xJmFtcDtpdGVtPWNhdGNoZXIlM2RzdHJlYW1zJTI2dXJsPScrbGluawoJCQkJCWlmIGxlbihsaW5rX2dldCk+MToKCQkJCQkJTGlzdC5hcHBlbmQoKGxpbmssY2hubCkpCgkJCQkJZWxzZToKCQkJCQkJYWRkTGluayhsaW5rLHRpbWUucmVwbGFjZSgnICcsJycpKyctJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksaWNvbixGQU5BUlQsJycsJycsJycsVHJ1ZSxOb25lLHJlZ2V4cyx0b3RhbCkJCQkJCQkKCQkJCWlmIGxlbihMaXN0KT4xOgoJCQkJCXZ1cmwgPSBzdHIoTGlzdCkucmVwbGFjZSgnWycsJ3N1YmxpbmsnKS5yZXBsYWNlKCddJywnIycpLnJlcGxhY2UoJ3N1YmxpbmsoXCcnLCdzdWJsaW5rOicpLnJlcGxhY2UoJ3BsdWdpbjonLCdMSVNUU09VUkNFOnBsdWdpbjonKS5yZXBsYWNlKCInLCAnIiwnOjpMSVNUTkFNRTonKS5yZXBsYWNlKCInKSwgKCciLCc6OiNzdWJsaW5rJykucmVwbGFjZSgiJykiLCcnKS5yZXBsYWNlKCdzdWJsaW5rTElTVFNPVVJDRScsJ3N1Ymxpbms6TElTVFNPVVJDRScpCgkJCQkJeGJtYy5sb2codnVybCkKCQkJCQlhZGREaXIodGltZS5yZXBsYWNlKCcgJywnJykrJy0nK25hbWUsdnVybCwzMCxpY29uLEZBTkFSVCwnJywnJywnJywnJykKCQkJCQlkZWwgTGlzdFs6XQoJCQoKCgkKCiMgYm9ycm93IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2VuZW45Mi9QMlAtU3RyZWFtcy1YQk1DL2Jsb2IvbWFzdGVyL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy9yZXNvdXJjZXMvY29yZS9saXZlc3RyZWFtcy5weQojIFRoaXMgd2lsbCBub3QgZ28gdGhyb3VnaCB0aGUgZ2V0SXRlbXMgZnVuY3Rpb25zICggbWVhbnMgeW91IG11c3QgaGF2ZSByZWFkeSB0byBwbGF5IHVybCwgbm8gcmVnZXgpCmRlZiBwYXJzZV9tM3UoZGF0YSk6CiAgICBjb250ZW50ID0gZGF0YS5yc3RyaXAoKQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cbl0rKScpLmZpbmRhbGwoY29udGVudCkKICAgIHRvdGFsID0gbGVuKG1hdGNoKQogICAgcHJpbnQgJ3RvdGFsIG0zdSBsaW5rcycsdG90YWwKICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoKICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOgogICAgICAgICAgICB0aHVtYm5haWwgPSByZV9tZShvdGhlciwndHZnLWxvZ289W1wnIl0oLio/KVtcJyJdJykKICAgICAgICAgICAgaWYgdGh1bWJuYWlsOgogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykgPT0gIiI6CiAgICAgICAgICAgICAgICAgICAgbG9nb191cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsCgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgaWYgJ3R5cGUnIGluIG90aGVyOgogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoKICAgICAgICAgICAgICAgIHN0cmVhbV91cmwgPSBzdHJlYW1fdXJsICsiJm1vZGU9MTgiCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6CiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAjcHJpbnQgdXJsWzBdIGdldFNvdXAodXJsLGRhdGE9Tm9uZSkKICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgYWRkTGluayhzdHJlYW1fdXJsLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpCgkJCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTApIikKCQpkZWYgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCk6CiAgICAgICAgc291cCA9IGdldFNvdXAodXJsKQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pCiAgICAgICAgaXRlbXMgPSBjaGFubmVsX2xpc3QoJ2l0ZW0nKQogICAgICAgIHRyeToKICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbF9saXN0KCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICByYWlzZQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbF9saXN0KCdzdWJjaGFubmVsJyk6CiAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXNjID0gY2hhbm5lbCgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ2VucmUgPSBjaGFubmVsKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY3JlZGl0cyA9IGNoYW5uZWwoJ2NyZWRpdHMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwzLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxjcmVkaXRzLGRhdGUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuQXJ0KQoKCmRlZiBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToKICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdzdWJjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkKICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnc3ViaXRlbScpCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KQoKI2hha2FtYWMKZGVmIEdldFN1YmxpbmtzKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQpOgogICAgeGJtYy5sb2coJ0kgR09UIEhFUkUjIyMjIyMjIyMjIyMjIyMnKQogICAgTGlzdD1bXTsgTGlzdFU9W107IGM9MAogICAgYWxsX3ZpZGVvcyA9IHJlZ2V4X2dldF9hbGwodXJsLCAnc3VibGluazonLCAnIycpCiAgICBmb3IgYSBpbiBhbGxfdmlkZW9zOgogICAgICAgIGlmICdMSVNUU09VUkNFOicgaW4gYToKICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJ0xJU1RTT1VSQ0U6JywgJzo6JykKICAgICAgICAgICAgbGluZW5hbWUgPSByZWdleF9mcm9tX3RvKGEsICdMSVNUTkFNRTonLCAnOjonKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZ1cmwgPSBhLnJlcGxhY2UoJ3N1Ymxpbms6JywnJykucmVwbGFjZSgnIycsJycpCiAgICAgICAgICAgIGxpbmVuYW1lID0gbmFtZQogICAgICAgIGlmIGxlbih2dXJsKSA+IDEwOgogICAgICAgICAgICBjPWMrMTsgTGlzdC5hcHBlbmQobGluZW5hbWUpOyBMaXN0VS5hcHBlbmQodnVybCkKIAogICAgaWYgYz09MToKICAgICAgICB0cnk6CiAgICAgICAgICAgICNwcmludCAncGxheSAxICAgTmFtZTonICsgbmFtZSArICcgICB1cmw6JyArIExpc3RVWzBdICsgJyAgICAgJyArIHN0cihjKQogICAgICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLHRodW1ibmFpbEltYWdlPWljb25pbWFnZSk7IGxpei5zZXRJbmZvKCB0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lIH0gKQogICAgICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPUxpc3RVWzBdLGxpc3RpdGVtPWxpeikKICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihMaXN0VVswXSksIGxpeikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgIGRpYWxvZz14Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgIHJObz1kaWFsb2cuc2VsZWN0KCdHZW4tWFNlbGVjdCBBIFNvdXJjZScsIExpc3QpCiAgICAgICAgIGlmIHJObz49MDoKICAgICAgICAgICAgIHJOYW1lPW5hbWUKICAgICAgICAgICAgIHJVUkw9c3RyKExpc3RVW3JOb10pCiAgICAgICAgICAgICAjcHJpbnQgJ1N1YmxpbmtzICAgTmFtZTonICsgbmFtZSArICcgICB1cmw6JyArIHJVUkwKICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKHJVUkwpLCB4Ym1jZ3VpLkxpc3RJdGVtKHJOYW1lKSkKICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkoclVSTCwgeGJtY2d1aS5MaXN0SXRlbShyTmFtZSkpCgoJCQkJCmRlZiBTZWFyY2hDaGFubmVscygpOgojaGFrYW1hYyBjb2RlCiAgICBLZXlib2FyZE1lc3NhZ2UgPSAnTmFtZSBvZiBjaGFubmVsIHNob3cgb3IgbW92aWUnCiAgICBTZWFyY2hrZXkgPSAnJwogICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKFNlYXJjaGtleSwgS2V5Ym9hcmRNZXNzYWdlKQogICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICBpZiBrZXlib2FyZC5pc0NvbmZpcm1lZCgpOgogICAgICAgU2VhcmNoa2V5ID0ga2V5Ym9hcmQuZ2V0VGV4dCgpLnJlcGxhY2UoJ1xuJywnJykuc3RyaXAoKQogICAgICAgaWYgbGVuKFNlYXJjaGtleSkgPT0gMDogCiAgICAgICAgICB4Ym1jZ3VpLkRpYWxvZygpLm9rKCdSb2Jpbkhvb2QnLCAnTm90aGluZyBFbnRlcmVkJykKICAgICAgICAgIHJldHVybgkgICAKICAgIAogICAgU2VhcmNoa2V5ID0gU2VhcmNoa2V5Lmxvd2VyKCkKICAgIExpc3Q9W10KICAgIExpc3QuYXBwZW5kKF9FZGl0Lk1haW5CYXNlKQogICAgUGFzc2VkVXJscyA9IDAKICAgIEZvdW5kQ2hhbm5lbCA9IDEgCiAgICBSZWFkQ2hhbm5lbCA9IDAKICAgIEZvdW5kTWF0Y2ggPSAwCiAgICBwcm9ncmVzcyA9IHhibWNndWkuRGlhbG9nUHJvZ3Jlc3MoKQogICAgcHJvZ3Jlc3MuY3JlYXRlKCdHZW4tWFNlYXJjaGluZyBQbGVhc2Ugd2FpdCcsJyAnKQoJCiAgICB3aGlsZSBGb3VuZENoYW5uZWwgPD4gUmVhZENoYW5uZWw6CiAgICAgICAgQmFzZVNlYXJjaCA9IExpc3RbUmVhZENoYW5uZWxdLnN0cmlwKCkKICAgICAgICBwcmludCAncmVhZCB0aGlzIG9uZSBmcm9tIGZpbGUgbGlzdCAoJyArIHN0cihSZWFkQ2hhbm5lbCkgKyAnKScgIAogICAgICAgIFJlYWRDaGFubmVsID0gUmVhZENoYW5uZWwgKyAxCgogICAgICAgIFBhZ2VTb3VyY2UgPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgUGFnZVNvdXJjZSA9IG5ldC5odHRwX0dFVChCYXNlU2VhcmNoKS5jb250ZW50CiAgICAgICAgICAgIFBhZ2VTb3VyY2UgPSBQYWdlU291cmNlLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykuZGVjb2RlKCdhc2NpaScpCiAgICAgICAgICAgICN0aW1lLnNsZWVwKDEpCiAgICAgICAgZXhjZXB0OiAKICAgICAgICAgICAgcGFzcwoJCQogICAgICAgIGlmIGxlbihQYWdlU291cmNlKSA8IDEwOgogICAgICAgICAgICBQYWdlU291cmNlID0gJycKICAgICAgICAgICAgUGFzc2VkVXJscyA9IFBhc3NlZFVybHMgKyAxCiAgICAgICAgICAgIHByaW50ICcqKiogUEFTU0VEICoqKionICsgQmFzZVNlYXJjaCArICcgICoqKioqKioqKioqKiogVG90YWwgUGFzc2VkIFVybHM6ICcgKyBzdHIoUGFzc2VkVXJscykKICAgICAgICAgICAgdGltZS5zbGVlcCguNSkKIAogICAgICAgIHBlcmNlbnQgPSBpbnQoICggUmVhZENoYW5uZWwgLyAzMDApICogMTAwKSAKICAgICAgICBtZXNzYWdlID0gJyAgICAgUGFnZXMgUmVhZDogJytzdHIoUmVhZENoYW5uZWwpKycgICAgICAgIE1hdGNoZXMgRm91bmQ6ICcgKyBzdHIoRm91bmRNYXRjaCkKICAgICAgICBwcm9ncmVzcy51cGRhdGUocGVyY2VudCwiIiwgbWVzc2FnZSwgIiIgKQoKICAgICAgICBpZiBwcm9ncmVzcy5pc2NhbmNlbGVkKCk6CiAgICAgICAgICAgcmV0dXJuCiAJCQogICAgICAgIGlmIGxlbihQYWdlU291cmNlKSA+IDEwOgogICAgICAgICAgICBhbGxfbGlua3MgPSByZWdleF9nZXRfYWxsKFBhZ2VTb3VyY2UsICc8Y2hhbm5lbD4nLCAnPC9jaGFubmVsPicpCiAgICAgICAgICAgIGZvciBhIGluIGFsbF9saW5rczoKICAgICAgICAgICAgICAgIHZ1cmwgPSByZWdleF9mcm9tX3RvKGEsICc8ZXh0ZXJuYWxsaW5rPicsICc8L2V4dGVybmFsbGluaz4nKQogICAgICAgICAgICAgICAgI25hbWUgPSByZWdleF9mcm9tX3RvKGEsICc8bmFtZT4nLCAnPC9uYW1lPicpCiAgICAgICAgICAgICAgICAjcHJpbnQgbmFtZSArICcgICAgJyArIHZ1cmwKICAgICAgICAgICAgICAgIGlmIGxlbih2dXJsKSA+IDU6CiAgICAgICAgICAgICAgICAgICBGb3VuZENoYW5uZWwgPSBGb3VuZENoYW5uZWwgKyAxCiAgICAgICAgICAgICAgICAgICBMaXN0LmFwcGVuZCh2dXJsKQogICAgICAgICAgICAgICAgICAgI3ByaW50ICdGb3VuZCBDaGFubmVsOiAnKyBzdHIoRm91bmRDaGFubmVsKSArJyA6ICcrIHZ1cmwgCgogICAgICAgICAgICBhbGxfaXRlbXMgPSByZWdleF9nZXRfYWxsKFBhZ2VTb3VyY2UsICc8aXRlbT4nLCAnPC9pdGVtPicpCiAgICAgICAgICAgIGZvciBhIGluIGFsbF9pdGVtczoKICAgICAgICAgICAgICAgIHZ1cmwgPSByZWdleF9mcm9tX3RvKGEsICc8bGluaz4nLCAnPC9saW5rPicpCiAgICAgICAgICAgICAgICBuYW1lID0gcmVnZXhfZnJvbV90byhhLCAnPHRpdGxlPicsICc8L3RpdGxlPicpCiAgICAgICAgICAgICAgICBUZXN0TmFtZSA9ICcgICcgKyBuYW1lLmxvd2VyKCkgKyAnICAnCiAgICAgICAgICAgICAgICAjcHJpbnQgJ1Rlc3Rpbmc6JyArIFRlc3ROYW1lICsgJyAgJyArIFNlYXJjaGtleQogICAgICAgICAgICAgICAgaWYgbGVuKHZ1cmwpID4gNSBhbmQgVGVzdE5hbWUuZmluZChTZWFyY2hrZXkpID4gMDoKICAgICAgICAgICAgICAgICAgICBGb3VuZE1hdGNoID0gRm91bmRNYXRjaCArIDEKICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSAnJwogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzx0aHVtYm5haWw+JywgJzwvdGh1bWJuYWlsPicpCiAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gcmVnZXhfZnJvbV90byhhLCAnPGZhbmFydD4nLCAnPC9mYW5hcnQ+JykKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZmFuYXJ0KSA8IDU6CiAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gaWNvbgogICAgICAgICAgICAgICAgICAgIGlmIHZ1cmwuZmluZCgnc3VibGluaycpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdnVybCwzMCx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgIGVsc2U6IAogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHN0cih2dXJsKSxuYW1lLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsVHJ1ZSxOb25lLCcnLDEpCgkJCQkJCQogICAgCiAgICBwcm9ncmVzcy5jbG9zZSgpCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTApIikKCQpkZWYgU2VhcmNoX20zdShkYXRhLFNlYXJjaGtleSk6CiAgICBjb250ZW50ID0gZGF0YS5yc3RyaXAoKQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cbl0rKScpLmZpbmRhbGwoY29udGVudCkKICAgIHRvdGFsID0gbGVuKG1hdGNoKQogICAgcHJpbnQgJ3RvdGFsIG0zdSBsaW5rcycsdG90YWwKICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoKICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOgogICAgICAgICAgICB0aHVtYm5haWwgPSByZV9tZShvdGhlciwndHZnLWxvZ289W1wnIl0oLio/KVtcJyJdJykKICAgICAgICAgICAgaWYgdGh1bWJuYWlsOgogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykgPT0gIiI6CiAgICAgICAgICAgICAgICAgICAgbG9nb191cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsCgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgI2Vsc2U6CiAgICAgICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgaWYgJ3R5cGUnIGluIG90aGVyOgogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoKICAgICAgICAgICAgICAgIHN0cmVhbV91cmwgPSBzdHJlYW1fdXJsICsiJm1vZGU9MTgiCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6CiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAjcHJpbnQgdXJsWzBdIGdldFNvdXAodXJsLGRhdGE9Tm9uZSkKICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgYWRkTGluayhzdHJlYW1fdXJsLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpCgpkZWYgRmluZEZpcnN0UGF0dGVybih0ZXh0LHBhdHRlcm4pOgogICAgcmVzdWx0ID0gIiIKICAgIHRyeTogICAgCiAgICAgICAgbWF0Y2hlcyA9IHJlLmZpbmRhbGwocGF0dGVybix0ZXh0LCBmbGFncz1yZS5ET1RBTEwpCiAgICAgICAgcmVzdWx0ID0gbWF0Y2hlc1swXQogICAgZXhjZXB0OgogICAgICAgIHJlc3VsdCA9ICIiCgogICAgcmV0dXJuIHJlc3VsdAoJCmRlZiByZWdleF9nZXRfYWxsKHRleHQsIHN0YXJ0X3dpdGgsIGVuZF93aXRoKToKICAgIHIgPSByZS5maW5kYWxsKCIoP2kpKCIgKyBzdGFydF93aXRoICsgIltcU1xzXSs/IiArIGVuZF93aXRoICsgIikiLCB0ZXh0KQogICAgcmV0dXJuIHIJCQkJCgpkZWYgcmVnZXhfZnJvbV90byh0ZXh0LCBmcm9tX3N0cmluZywgdG9fc3RyaW5nLCBleGNsdWRpbmc9VHJ1ZSk6CiAgICBpZiBleGNsdWRpbmc6CgkgICB0cnk6IHIgPSByZS5zZWFyY2goIig/aSkiICsgZnJvbV9zdHJpbmcgKyAiKFtcU1xzXSs/KSIgKyB0b19zdHJpbmcsIHRleHQpLmdyb3VwKDEpCgkgICBleGNlcHQ6IHIgPSAnJwogICAgZWxzZToKICAgICAgIHRyeTogciA9IHJlLnNlYXJjaCgiKD9pKSgiICsgZnJvbV9zdHJpbmcgKyAiW1xTXHNdKz8iICsgdG9fc3RyaW5nICsgIikiLCB0ZXh0KS5ncm91cCgxKQogICAgICAgZXhjZXB0OiByID0gJycKICAgIHJldHVybiByCgpkZWYgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KToKICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykKICAgICAgICBwcmludCAnU1RBUlQgR0VUIElURU1TICoqKioqJwogICAgICAgIGFkZG9uX2xvZygnVG90YWwgSXRlbXM6ICVzJyAldG90YWwpCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6CiAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCiAgICAgICAgICAgIGlzSnNvbnJwYyA9IEZhbHNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hbWUgPSBpdGVtKCd0aXRsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgbmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAndW5rbm93bj8nCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnTmFtZSBFcnJvcicpCiAgICAgICAgICAgICAgICBuYW1lID0gJycKCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBpdGVtKCdlcGcnKToKICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLmVwZ191cmw6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnR2V0IEVQRyBSZWdleCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ191cmwgPSBpdGVtLmVwZ191cmwuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19yZWdleCA9IGl0ZW0uZXBnX3JlZ2V4LnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBlcGdfbmFtZSA9IGdldF9lcGcoZXBnX3VybCwgZXBnX3JlZ2V4KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBlcGdfbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gJyAtICcgKyBlcGdfbmFtZQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXRlbSgnZXBnJylbMF0uc3RyaW5nID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSBnZXRlcGcoaXRlbSgnZXBnJylbMF0uc3RyaW5nKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRVBHIEVycm9yJykKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXJsID0gW10KICAgICAgICAgICAgICAgIGlmIGxlbihpdGVtKCdsaW5rJykpID4wOgojICAgICAgICAgICAgICAgICAgICBwcmludCAnaXRlbSBsaW5rJywgaXRlbSgnbGluaycpCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnbGluaycpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdzcG9ydHNkZXZpbCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdzcG9ydHNkZXZpbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3J0c2RldmlsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5TcG9ydHNEZXZpbC8/bW9kZT0xJmFtcDtpdGVtPWNhdGNoZXIlM2RzdHJlYW1zJTI2dXJsPScgK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVyID0gaXRlbSgncmVmZXJlcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVmZXJlcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3JlZmVyZXIgZm91bmQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSBzcG9ydHNkZXZpbCArICclMjZyZWZlcmVyPScgK3JlZmVyZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc3BvcnRzZGV2aWwpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdwMnAnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgncDJwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3NvcDovLycgaW4gaToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3AgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz91cmw9JytpLnN0cmluZyArJyZhbXA7bW9kZT0yJmFtcDsnICsgJ25hbWU9JytuYW1lIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc29wKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJwPSdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP3VybD0nK2kuc3RyaW5nICsnJmFtcDttb2RlPTEmYW1wOycgKyAnbmFtZT0nK25hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChwMnApCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd2YXVnaG4nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndmF1Z2huJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmF1Z2huID0gJ3BsdWdpbjovL3BsdWdpbi5zdHJlYW0udmF1Z2hubGl2ZS50di8/bW9kZT1QbGF5TGl2ZVN0cmVhbSZhbXA7Y2hhbm5lbD0nK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHZhdWdobikKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2lsaXZlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2lsaXZlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90ICdodHRwJyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9aHR0cDovL3d3dy5zdHJlYW1saXZlLnRvL3ZpZXcvJytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPScraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd5dC1kbCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd5dC1kbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0ZGwgPSBpLnN0cmluZyArICcmbW9kZT0xOCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoeXRkbCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3V0dWJlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3V0dWJlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGkuc3RyaW5nKSA9PSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nKyBpLnN0cmluZyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnUEwnKSBhbmQgbm90ICcmb3JkZXI9JyBpbiBpLnN0cmluZyA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/Jm9yZGVyPWRlZmF1bHQmcGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3BsYXlsaXN0X2lkPScgKyBpLnN0cmluZyAKICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHV0dWJlKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaW1kYicpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbWRiJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZ2VuZXNpc29ycHVsc2FyJykgPT0gJzAnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1wbGF5JmltZGI9JytpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wdWxzYXIvbW92aWUvdHQnK2kuc3RyaW5nKycvcGxheScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaW1kYikgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmNG0nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Y0bScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJy5mNG0nIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLm0zdTgnIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9SExTJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9U0lNUExFJwogICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGY0bSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2Z0dicpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdmdHYnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdHYgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLkYuVC5WLz9uYW1lPScrdXJsbGliLnF1b3RlKG5hbWUpICsnJnVybD0nICtpLnN0cmluZyArJyZtb2RlPTEyNSZjaF9mYW5hcnQ9bmEnCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZnR2KSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPCAxOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRXJyb3IgPGxpbms+IGVsZW1lbnQsIFBhc3Npbmc6JytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZSA9IGl0ZW0oJ2V4dGVybmFsbGluaycpWzBdLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOgogICAgICAgICAgICAgICAgZXh0X3VybD1baXNYTUxTb3VyY2VdCiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZT1UcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpc0pzb25ycGMgPSBpdGVtKCdqc29ucnBjJylbMF0uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICBpZiBpc0pzb25ycGM6CiAgICAgICAgICAgICAgICBleHRfdXJsPVtpc0pzb25ycGNdCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9VHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaXNKc29ucnBjPUZhbHNlICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGl0ZW0oJ3RodW1ibmFpbCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbm90IGl0ZW0oJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGl0ZW0oJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlc2MgPSBpdGVtKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnZW5yZSA9IGl0ZW0oJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGUgPSBpdGVtKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICByZWdleHMgPSBOb25lCiAgICAgICAgICAgIGlmIGl0ZW0oJ3JlZ2V4Jyk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVnX2l0ZW0gPSBpdGVtKCdyZWdleCcpCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgocmVnX2l0ZW0pCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcyAgICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA+IDE6CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYWx0ID0gMAogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0ID0gW10KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6CiAgICAgICAgICAgICAgICAgICAgCWlmIGFkZG9uLmdldFNldHRpbmcoJ2Fza19wbGF5bGlzdF9pdGVtcycpID09ICd0cnVlJzoKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJnJlZ2V4cz0nK3JlZ2V4cykKCSAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgIGFueSh4IGluIGkgZm9yIHggaW4gcmVzb2x2ZV91cmwpIGFuZCAgaS5zdGFydHN3aXRoKCdodHRwJyk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZtb2RlPTE5JykgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkKICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnQURETElOSyAxJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoaSwnJXMpICVzJyAlKGFsdCwgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluaygnJywgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBpc1hNTFNvdXJjZToKICAgICAgICAgICAgICAgICAgICAJYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGV4dF91cmxbMF0uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgICAgICBlbGlmIGlzSnNvbnJwYzoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGV4dF91cmxbMF0sNTMsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgICAgICBlbGlmIHVybFswXS5maW5kKCdzdWJsaW5rJykgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksdXJsWzBdLDMwLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgICAgICNhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksdXJsWzBdLDMwLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLCdzdWJsaW5rJykJCQkJCiAgICAgICAgICAgICAgICAgICAgZWxzZTogCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQoKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N1Y2Nlc3MnCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgaXRlbSAtICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgIHByaW50ICdGSU5JU0ggR0VUIElURU1TICoqKioqJyAgICAgIAoKZGVmIHBhcnNlX3JlZ2V4KHJlZ19pdGVtKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB7fQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJlZ19pdGVtOgogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ10gPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlJ109JycKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncGFnZSddID0gaSgncGFnZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlZmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvbm5lY3Rpb24nXSA9IGkoJ2Nvbm5lY3Rpb24nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBub3RwbGF5YWJsZSAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydub3JlZGlyZWN0J10gPSBpKCdub3JlZGlyZWN0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vcmVkaXJlY3QgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ29yaWdpbiddID0gaSgnb3JpZ2luJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG9yaWdpbiAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaW5jbHVkZWhlYWRlcnMnXSA9IGkoJ2luY2x1ZGVoZWFkZXJzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIGluY2x1ZGVoZWFkZXJzIC0tIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LXJlcSddID0gaSgneC1yZXEnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1yZXEgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtZm9yd2FyZCddID0gaSgneC1mb3J3YXJkJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtZm9yd2FyZCAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FnZW50J10gPSBpKCdhZ2VudCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBVc2VyIEFnZW50IC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwb3N0J10gPSBpKCdwb3N0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHBvc3QiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Jhd3Bvc3QnXSA9IGkoJ3Jhd3Bvc3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcmF3cG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaHRtbHVuZXNjYXBlJ10gPSBpKCdodG1sdW5lc2NhcGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgaHRtbHVuZXNjYXBlIikKCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlYWRjb29raWVvbmx5J10gPSBpKCdyZWFkY29va2llb25seScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByZWFkQ29va2llT25seSIpCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ10gPSBpKCdjb29raWVqYXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ109JycKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgY29va2llSmFyIikJCQkJCQkJCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnc2V0Y29va2llJ10gPSBpKCdzZXRjb29raWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgc2V0Y29va2llIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydhcHBlbmRjb29raWUnXSA9IGkoJ2FwcGVuZGNvb2tpZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBhcHBlbmRjb29raWUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikKICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2lnbm9yZWNhY2hlJ10gPSBpKCdpZ25vcmVjYWNoZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAjZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikJCQkKCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gdXJsbGliLnF1b3RlKHJlcHIocmVnZXhzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzCiAgICAgICAgICAgICAgICAgICAgI3ByaW50IHJlZ2V4cwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IEVycm9yOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKI2NvcGllcyBmcm9tIGxhbWRhJ3MgaW1wbGVtZW50YXRpb24KZGVmIGdldF91c3RyZWFtKHVybCk6CiAgICB0cnk6CiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgNTEpOgogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQogICAgICAgICAgICBpZiAiRVhULVgtU1RSRUFNLUlORiIgaW4gcmVzdWx0OiByZXR1cm4gdXJsCiAgICAgICAgICAgIGlmIG5vdCAiRVhUTTNVIiBpbiByZXN1bHQ6IHJldHVybgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuCiAgICAgICAgCiAKZGVmIGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsLGNvb2tpZUphcj1Ob25lLGZvckNvb2tpZUphck9ubHk9RmFsc2UscmVjdXJzaXZlQ2FsbD1GYWxzZSxjYWNoZWRQYWdlcz17fSwgcmF3UG9zdD1GYWxzZSwgY29va2llX2phcl9maWxlPU5vbmUpOiMwLDEsMiA9IFVSTCwgcmVnZXhPbmx5LCBDb29raWVKYXJPbmx5CiAgICAgICAgaWYgbm90IHJlY3Vyc2l2ZUNhbGw6CiAgICAgICAgICAgIHJlZ2V4cyA9IGV2YWwodXJsbGliLnVucXVvdGUocmVnZXhzKSkKICAgICAgICAjY2FjaGVkUGFnZXMgPSB7fQogICAgICAgICNwcmludCAndXJsJyx1cmwKICAgICAgICBkb1JlZ2V4cyA9IHJlLmNvbXBpbGUoJ1wkZG9yZWdleFxbKFteXF1dKilcXScpLmZpbmRhbGwodXJsKQogICAgICAgICNwcmludCAnZG9SZWdleHMnLGRvUmVnZXhzLHJlZ2V4cwogICAgICAgIHNldHJlc29sdmVkPVRydWUKICAgICAgICAgICAgICAKIAoKCiAgICAgICAgZm9yIGsgaW4gZG9SZWdleHM6CiAgICAgICAgICAgIGlmIGsgaW4gcmVnZXhzOgogICAgICAgICAgICAgICAgI3ByaW50ICdwcm9jZXNzaW5nICcgLGsKICAgICAgICAgICAgICAgIG0gPSByZWdleHNba10KICAgICAgICAgICAgICAgICNwcmludCBtCiAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1GYWxzZQoKCiAgICAgICAgICAgICAgICBpZiAgJ2Nvb2tpZWphcicgaW4gbTogIyBzbyBlaXRoZXIgY3JlYXRlIG9yIHJldXNlIGV4aXN0aW5nIGphcgogICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llamFyIGV4aXN0cycsbVsnY29va2llamFyJ10KICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1tWydjb29raWVqYXInXQogICAgICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIGNvb2tpZUphclBhcmFtOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydjb29raWVqYXInXSxjb29raWVKYXIsVHJ1ZSwgVHJ1ZSxjYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUKICAgICAgICAgICAgICAgICNwcmludCAnbVtjb29raWVqYXJdJyxtWydjb29raWVqYXInXSxjb29raWVKYXIKICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphclBhcmFtOgogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphcj09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjcmVhdGUgY29va2llIGphcicKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPU5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29wZW5bJyBpbiBtWydjb29raWVqYXInXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnb3BlblsnKVsxXS5zcGxpdCgnXScpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldENvb2tpZUphcihjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZV9qYXJfZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgI2ltcG9ydCBjb29raWVsaWIKICAgICAgICAgICAgICAgICAgICAgICAgI2Nvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphciBuZXcnLGNvb2tpZUphcgogICAgICAgICAgICAgICAgICAgIGVsaWYgJ3NhdmVbJyBpbiBtWydjb29raWVqYXInXToKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPW1bJ2Nvb2tpZWphciddLnNwbGl0KCdzYXZlWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdjb21wbGV0ZV9wYXRoJyxjb21wbGV0ZV9wYXRoCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAKICAgICAgICAgICAgICAgIGlmICBtWydwYWdlJ10gYW5kICckZG9yZWdleCcgaW4gbVsncGFnZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3BhZ2UnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQoKICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG0gYW5kIG1bJ3NldGNvb2tpZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3NldGNvb2tpZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ3NldGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnc2V0Y29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG0gYW5kIG1bJ2FwcGVuZGNvb2tpZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ2FwcGVuZGNvb2tpZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ2FwcGVuZGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnYXBwZW5kY29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKCiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAgJ3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgIHByaW50ICdwb3N0IGlzIG5vdycsbVsncG9zdCddCgogICAgICAgICAgICAgICAgaWYgICdyYXdwb3N0JyBpbiBtIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydyYXdwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcyxyYXdQb3N0PVRydWUpCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyYXdwb3N0IGlzIG5vdycsbVsncmF3cG9zdCddCiAgCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZSQnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZTIkJyBpbiBtWydyYXdwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogIAogICAgICAgICAgICAgICAgbGluaz0nJwogICAgICAgICAgICAgICAgaWYgbVsncGFnZSddIGFuZCBtWydwYWdlJ10gaW4gY2FjaGVkUGFnZXMgYW5kIG5vdCAnaWdub3JlY2FjaGUnIGluIG0gYW5kIGZvckNvb2tpZUphck9ubHk9PUZhbHNlIDoKICAgICAgICAgICAgICAgICAgICBsaW5rID0gY2FjaGVkUGFnZXNbbVsncGFnZSddXQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kICBub3QgbVsncGFnZSddPT0nJyBhbmQgIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gbVsncGFnZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ0luZ29yaW5nIENhY2hlJyxtWydwYWdlJ10KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9zcGxpdD1tWydwYWdlJ10uc3BsaXQoJ3wnKQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlVXJsPXBhZ2Vfc3BsaXRbMF0KICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9Tm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFnZV9zcGxpdCk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPXBhZ2Vfc3BsaXRbMV0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHBhZ2VVcmwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmVmZXInIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignUmVmZXJlcicsIG1bJ3JlZmVyJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtcmVxJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtRm9yd2FyZGVkLUZvcicsIG1bJ3gtZm9yd2FyZCddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FkZGluZyBjb29raWUnLG1bJ3NldGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYXBwZW5kaW5nIGNvb2tpZSB0byBjb29raWVqYXInLG1bJ2FwcGVuZGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1tWydhcHBlbmRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9Y29va2llc3RvQXBlbmQuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gY29va2llc3RvQXBlbmQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcsbj0gbi5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2sgPSBjb29raWVsaWIuQ29va2llKHZlcnNpb249MCwgbmFtZT1uLCB2YWx1ZT12LCBwb3J0PU5vbmUsIHBvcnRfc3BlY2lmaWVkPUZhbHNlLCBkb21haW49dywgZG9tYWluX3NwZWNpZmllZD1GYWxzZSwgZG9tYWluX2luaXRpYWxfZG90PUZhbHNlLCBwYXRoPScvJywgcGF0aF9zcGVjaWZpZWQ9VHJ1ZSwgc2VjdXJlPUZhbHNlLCBleHBpcmVzPU5vbmUsIGRpc2NhcmQ9VHJ1ZSwgY29tbWVudD1Ob25lLCBjb21tZW50X3VybD1Ob25lLCByZXN0PXsnSHR0cE9ubHknOiBOb25lfSwgcmZjMjEwOT1GYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXIuc2V0X2Nvb2tpZShjaykKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcmlnaW4nIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignT3JpZ2luJywgbVsnb3JpZ2luJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhlYWRlcl9pbl9wYWdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gaGVhZGVyX2luX3BhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKG4sdikKCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXJWYWwnLGNvb2tpZUphcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnbm9yZWRpcmVjdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoTm9SZWRpcmVjdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcjIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdjb25uZWN0aW9uJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uY29ubmVjdGlvbi8vLy8vLy4nLG1bJ2Nvbm5lY3Rpb24nXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBrZWVwYWxpdmUgaW1wb3J0IEhUVFBIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZWVwYWxpdmVfaGFuZGxlciA9IEhUVFBIYW5kbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGtlZXBhbGl2ZV9oYW5kbGVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdhZnRlciBjb29raWUgamFyJwogICAgICAgICAgICAgICAgICAgICAgICBwb3N0PU5vbmUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwb3N0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGE9bVsncG9zdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3REYXRhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQpPXByb2Nlc3NSZWNhcHRjaGEobVsncGFnZSddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhcHRjaGFfY2hhbGxlbmdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YSs9J3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ6JytjYXB0Y2hhX2NoYWxsZW5nZSsnLHJlY2FwdGNoYV9yZXNwb25zZV9maWVsZDonK2NhdHBjaGFfd29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRwb3N0PXBvc3REYXRhLnNwbGl0KCcsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0PXt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcCBpbiBzcGxpdHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbj1wLnNwbGl0KCc6JylbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdj1wLnNwbGl0KCc6JylbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFtuXT12CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0ID0gdXJsbGliLnVybGVuY29kZShwb3N0KQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0PW1bJ3Jhd3Bvc3QnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQpPXByb2Nlc3NSZWNhcHRjaGEobVsncGFnZSddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhcHRjaGFfY2hhbGxlbmdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QrPScmcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK2NhcHRjaGFfY2hhbGxlbmdlKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrY2F0cGNoYV93b3JkCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICBsaW5rPWphdmFzY3JpcHRVbkVzY2FwZShsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGluayBUaGlzIGp1c3QgcHJpbnQgd2hvbGUgd2VicGFnZSBpbiBMT0cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluays9c3RyKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdTZXQtQ29va2llJykpCgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFBhZ2VzW21bJ3BhZ2UnXV0gPSBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZwogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsncGFnZSddIGFuZCAgbm90IG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29va2llSmFyIyBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPXZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1tWydwYWdlJ10KICAgICAgICAgICAgICAgIGlmICckcHlGdW5jdGlvbjpwbGF5bWVkaWEoJyBpbiBtWydleHByZSddIG9yICdBY3RpdmF0ZVdpbmRvdycgIGluIG1bJ2V4cHJlJ10gICBvciAgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOgogICAgICAgICAgICAgICAgICAgIHNldHJlc29sdmVkPUZhbHNlCiAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBtWydleHByZSddOgogICAgICAgICAgICAgICAgICAgIG1bJ2V4cHJlJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBtWydleHByZSddPT0nJzoKICAgICAgICAgICAgICAgICAgICBwcmludCAnZG9pbmcgaXQgJyxtWydleHByZSddCiAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtQ2FwdGNoYScgaW4gbVsnZXhwcmUnXToKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWFza0NhcHRjaGEobSxsaW5rLGNvb2tpZUphcikKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICd1cmwgYW5kIHZhbCcsdXJsLHZhbAogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ2V4cHJlJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZXhwZWVlZWVlZWVlZWVlZWVlZWVlZScsbVsnZXhwcmUnXQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ2V4cHJlJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLGxpbmssY29va2llSmFyICkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ0FjdGl2YXRlV2luZG93JyBpbiBtWydleHByZSddOiByZXR1cm4gCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdzdGlsbCBocmUnCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmwgayB2YWwnLHVybCxrLHZhbAoKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGxpbms9PScnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnID0gcmUuY29tcGlsZShtWydleHByZSddKS5zZWFyY2gobGluaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0nJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZWcuZ3JvdXAoMSkuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1tWydleHByZSddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJhd1Bvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAncmF3cG9zdCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD11cmxsaWIucXVvdGVfcGx1cyh2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdodG1sdW5lc2NhcGUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjdmFsPXVybGxpYi51bnF1b3RlX3BsdXModmFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IEhUTUxQYXJzZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1IVE1MUGFyc2VyLkhUTUxQYXJzZXIoKS51bmVzY2FwZSh2YWwpICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgICAgICAjcmV0dXJuIHZhbAogICAgICAgICAgICAgICAgZWxzZTogICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwnJykKICAgICAgICBpZiAnJGVwb2N0aW1lJCcgaW4gdXJsOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQoKICAgICAgICBpZiAnJEdVSUQkJyBpbiB1cmw6CiAgICAgICAgICAgIGltcG9ydCB1dWlkCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJEdVSUQkJyxzdHIodXVpZC51dWlkMSgpKS51cHBlcigpKQogICAgICAgIGlmICckZ2V0X2Nvb2tpZXMkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGdldF9jb29raWVzJCcsZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpKSAgIAoKICAgICAgICBpZiByZWN1cnNpdmVDYWxsOiByZXR1cm4gdXJsCiAgICAgICAgcHJpbnQgJ2ZpbmFsIHVybCcsdXJsCiAgICAgICAgaWYgdXJsPT0iIjogCiAgICAgICAgCXJldHVybgogICAgICAgIGVsc2U6CiAgICAgICAgCXJldHVybiB1cmwsc2V0cmVzb2x2ZWQKCiAgICAgICAgICAgIAogICAgICAgIApkZWYgZ2V0bWQ1KHQpOgogICAgaW1wb3J0IGhhc2hsaWIKICAgIGg9aGFzaGxpYi5tZDUoKQogICAgaC51cGRhdGUodCkKICAgIHJldHVybiBoLmhleGRpZ2VzdCgpCgpkZWYgZGVjcnlwdF92YXVnaG5saXZlKGVuY3J5cHRlZCk6CiAgICByZXRWYWw9IiIKICAgIGZvciB2YWwgaW4gZW5jcnlwdGVkLnNwbGl0KCc6Jyk6CiAgICAgICAgcmV0VmFsKz1jaHIoaW50KHZhbC5yZXBsYWNlKCIwbTAiLCIiKSkvODQvNSkKICAgIHJldHVybiByZXRWYWwKCmRlZiBwbGF5bWVkaWEobWVkaWFfdXJsKToKICAgIHRyeToKICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcgogICAgICAgIHBsYXllciA9IEN1c3RvbVBsYXllci5NeVhCTUNQbGF5ZXIoKQogICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbSggbGFiZWwgPSBzdHIobmFtZSksIGljb25JbWFnZSA9ICJEZWZhdWx0VmlkZW8ucG5nIiwgdGh1bWJuYWlsSW1hZ2UgPSB4Ym1jLmdldEluZm9JbWFnZSggIkxpc3RJdGVtLlRodW1iIiApLCBwYXRoPW1lZGlhX3VybCApCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkKICAgICAgICB4Ym1jLnNsZWVwKDEwMDApCiAgICAgICAgd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToKICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDApCiAgICBleGNlcHQ6CiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICByZXR1cm4gJycKICAgIAogICAgICAgIApkZWYgZ2V0X3Nhd19ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6CiAgICBpZiByZWZlcmVyOgogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlX3VybD1wYWdlX3ZhbHVlCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUsaGVhZGVycz1yZWZlcmVyKQoKICAgIHN0cl9wYXR0ZXJuPSIoZXZhbFwoZnVuY3Rpb25cKHAsYSxjLGssZSwoPzpyfGQpLiopIgoKICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKQogICAgcj0iIgogICAgaWYgcmVnX3JlcyBhbmQgbGVuKHJlZ19yZXMpPjA6CiAgICAgICAgZm9yIHYgaW4gcmVnX3JlczoKICAgICAgICAgICAgcjE9Z2V0X3VucGFja2VkKHYpCiAgICAgICAgICAgIHIyPXJlX21lKHIxLCdcJyguKj8pXCcnKQogICAgICAgICAgICBpZiAndW5lc2NhcGUnIGluIHIxOgogICAgICAgICAgICAgICAgcjE9dXJsbGliLnVucXVvdGUocjIpCiAgICAgICAgICAgIHIrPXIxKydcbicKICAgICAgICBwcmludCAnZmluYWwgdmFsdWUgaXMgJyxyCiAgICAgICAgCiAgICAgICAgcGFnZV91cmw9cmVfbWUociwnc3JjPSIoLio/KSInKQogICAgICAgIAogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3VybCxoZWFkZXJzPXJlZmVyZXIpCgogICAgI3ByaW50IHBhZ2VfdmFsdWUKCiAgICBydG1wPXJlX21lKHBhZ2VfdmFsdWUsJ3N0cmVhbWVyXCcuKj9cJyguKj8pXCdcKScpCiAgICBwbGF5cGF0aD1yZV9tZShwYWdlX3ZhbHVlLCdmaWxlXCcsXHNcJyguKj8pXCcnKQoKICAgIAogICAgcmV0dXJuIHJ0bXArJyBwbGF5cGF0aD0nK3BsYXlwYXRoICsnIHBhZ2VVcmw9JytwYWdlX3VybAogICAgCmRlZiBnZXRfbGV0b25fcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOgogICAgaWYgcmVmZXJlcjoKICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUsaGVhZGVycz1yZWZlcmVyKQogICAgc3RyX3BhdHRlcm49InZhciBhID0gKC4qPyk7XHMqdmFyIGIgPSAoLio/KTtccyp2YXIgYyA9ICguKj8pO1xzKnZhciBkID0gKC4qPyk7XHMqdmFyIGYgPSAoLio/KTtccyp2YXIgdl9wYXJ0ID0gJyguKj8pJzsiCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gCgogICAgYSxiLGMsZCxmLHY9KHJlZ19yZXMpCiAgICBmPWludChmKQogICAgYT1pbnQoYSkvZgogICAgYj1pbnQoYikvZgogICAgYz1pbnQoYykvZgogICAgZD1pbnQoZCkvZgoKICAgIHJldD0gJ3J0bXA6Ly8nICsgc3RyKGEpICsgJy4nICsgc3RyKGIpICsgJy4nICsgc3RyKGMpICsgJy4nICsgc3RyKGQpICsgdjsKICAgIHJldHVybiByZXQKCmRlZiBjcmVhdGVNM3VGb3JEYXNoKHVybCx1c2VyYWdlbnQ9Tm9uZSk6CiAgICBzdHI9JyNFWFRNM1UnCiAgICBzdHIrPSdcbiNFWFQtWC1TVFJFQU0tSU5GOlBST0dSQU0tSUQ9MSxCQU5EV0lEVEg9MzYxODE2JwogICAgc3RyKz0nXG4nK3VybCsnJmJ5dGVzPTAtMjAwMDAwJyMrJ3xVc2VyLUFnZW50PScrdXNlcmFnZW50CiAgICBzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAndGVzdGZpbGUubTN1JykKICAgIHN0cis9J1xuJwogICAgU2F2ZVRvRmlsZShzb3VyY2VfZmlsZSxzdHIpCiAgICAjcmV0dXJuICdDOi9Vc2Vycy9zaGFuaS9Eb3dubG9hZHMvdGVzdC5tM3U4JwogICAgcmV0dXJuIHNvdXJjZV9maWxlCgpkZWYgU2F2ZVRvRmlsZShmaWxlX25hbWUscGFnZV9kYXRhLGFwcGVuZD1GYWxzZSk6CiAgICBpZiBhcHBlbmQ6CiAgICAgICAgZiA9IG9wZW4oZmlsZV9uYW1lLCAnYScpCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpCiAgICAgICAgZi5jbG9zZSgpICAgICAgICAKICAgIGVsc2U6CiAgICAgICAgZj1vcGVuKGZpbGVfbmFtZSwnd2InKQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQogICAgICAgIGYuY2xvc2UoKQogICAgICAgIHJldHVybiAnJwogICAgCmRlZiBMb2FkRmlsZShmaWxlX25hbWUpOgoJZj1vcGVuKGZpbGVfbmFtZSwncmInKQoJZD1mLnJlYWQoKQoJZi5jbG9zZSgpCglyZXR1cm4gZAogICAgCmRlZiBnZXRfcGFja2VkX2lwaG9uZXR2X3VybChwYWdlX2RhdGEpOgoJaW1wb3J0IHJlLGJhc2U2NCx1cmxsaWI7IAoJcz1wYWdlX2RhdGEKCXdoaWxlICdnZWgoJyBpbiBzOgoJCWlmIHMuc3RhcnRzd2l0aCgnbG9sKCcpOiBzPXNbNTotMV0gICAgCiMJCXByaW50ICdzIGlzICcscwoJCXM9cmUuY29tcGlsZSgnIiguKj8pIicpLmZpbmRhbGwocylbMF07IAoJCXM9ICBiYXNlNjQuYjY0ZGVjb2RlKHMpOyAKCQlzPXVybGxpYi51bnF1b3RlKHMpOyAKCXByaW50IHMKCXJldHVybiBzCgpkZWYgZ2V0X2ZlcnJhcmlfdXJsKHBhZ2VfZGF0YSk6CiAgICBwcmludCAnZ2V0X2RhZ191cmwyJyxwYWdlX2RhdGEKICAgIHBhZ2VfZGF0YTI9Z2V0VXJsKHBhZ2VfZGF0YSk7CiAgICBwYXR0PScoaHR0cC4qKScKICAgIGltcG9ydCB1dWlkCiAgICBwbGF5YmFjaz1zdHIodXVpZC51dWlkMSgpKS51cHBlcigpCiAgICBsaW5rcz1yZS5jb21waWxlKHBhdHQpLmZpbmRhbGwocGFnZV9kYXRhMikKICAgIGhlYWRlcnM9WygnWC1QbGF5YmFjay1TZXNzaW9uLUlkJyxwbGF5YmFjayldCiAgICBmb3IgbCBpbiBsaW5rczoKICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwYWdlX2RhdGF0ZW1wPWdldFVybChsLGhlYWRlcnM9aGVhZGVycyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAKICAgIHJldHVybiBwYWdlX2RhdGErJ3wmWC1QbGF5YmFjay1TZXNzaW9uLUlkPScrcGxheWJhY2sKCiAgICAKZGVmIGdldF9kYWdfdXJsKHBhZ2VfZGF0YSk6CiAgICBwcmludCAnZ2V0X2RhZ191cmwnLHBhZ2VfZGF0YQogICAgaWYgcGFnZV9kYXRhLnN0YXJ0c3dpdGgoJ2h0dHA6Ly9kYWcudG90YWwtc3RyZWFtLm5ldCcpOgogICAgICAgIGhlYWRlcnM9WygnVXNlci1BZ2VudCcsJ1ZlcmlzbW8tQmxhY2tVSV8oMi40LjcuNS44LjAuMzQpJyldCiAgICAgICAgcGFnZV9kYXRhPWdldFVybChwYWdlX2RhdGEsaGVhZGVycz1oZWFkZXJzKTsKCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6CiAgICAgICAgcmV0dXJuIHJldmlzdF9kYWcocGFnZV9kYXRhKQogICAgZWxpZiByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgIT0gJyc6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykKICAgIGVsc2U6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnaHJlZj0iKFteIl0rKSJbXiJdKyQnKQogICAgICAgIGlmIGxlbihmaW5hbF91cmwpPT0wOgogICAgICAgICAgICBmaW5hbF91cmw9cGFnZV9kYXRhCiAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnICcsICclMjAnKQogICAgcmV0dXJuIGZpbmFsX3VybAoKZGVmIHJlX21lKGRhdGEsIHJlX3BhdHRlbik6CiAgICBtYXRjaCA9ICcnCiAgICBtID0gcmUuc2VhcmNoKHJlX3BhdHRlbiwgZGF0YSkKICAgIGlmIG0gIT0gTm9uZToKICAgICAgICBtYXRjaCA9IG0uZ3JvdXAoMSkKICAgIGVsc2U6CiAgICAgICAgbWF0Y2ggPSAnJwogICAgcmV0dXJuIG1hdGNoCgpkZWYgcmV2aXN0X2RhZyhwYWdlX2RhdGEpOgogICAgZmluYWxfdXJsID0gJycKICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICcgbGl2ZT10cnVlIHRpbWVvdXQ9MTUgcGxheXBhdGg9JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFthLXpBLVowLTktX1xcLkBdKyknKQogICAgICAgIAogICAgaWYgcmVfbWUocGFnZV9kYXRhLCAndG9rZW49KFteJl0rKSYnKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwgKyAnP3Rva2VuPScgKyByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQogICAgZWxzZToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdIUkVGPSIoW14iXSspIicpCgogICAgaWYgJ2RhZzEuYXN4JyBpbiBmaW5hbF91cmw6CiAgICAgICAgcmV0dXJuIGdldF9kYWdfdXJsKGZpbmFsX3VybCkKCiAgICBpZiAnZGV2aW5saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnZGV2aW5saXZlJywgJ2ZsaXZlJykKICAgIGlmICdwZXJtbGl2ZWZzLmZwbGl2ZS5uZXQnIG5vdCBpbiBmaW5hbF91cmw6CiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ3Blcm1saXZlJywgJ2ZsaXZlJykKICAgIHJldHVybiBmaW5hbF91cmwKCgpkZWYgZ2V0X3Vud2lzZSggc3RyX2V2YWwpOgogICAgcGFnZV92YWx1ZT0iIgogICAgdHJ5OiAgICAgICAgCiAgICAgICAgc3M9IncsaSxzLGU9KCIrc3RyX2V2YWwrJyknIAogICAgICAgIGV4ZWMgKHNzKQogICAgICAgIHBhZ2VfdmFsdWU9dW53aXNlX2Z1bmModyxpLHMsZSkKICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICAjcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlCiAgICByZXR1cm4gcGFnZV92YWx1ZQogICAgCmRlZiB1bndpc2VfZnVuYyggdywgaSwgcywgZSk6CiAgICBsSWxsID0gMDsKICAgIGxsMUkgPSAwOwogICAgSWwxbCA9IDA7CiAgICBsbDFsID0gW107CiAgICBsMWxJID0gW107CiAgICB3aGlsZSBUcnVlOgogICAgICAgIGlmIChsSWxsIDwgNSk6CiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHdbbElsbF0pCiAgICAgICAgZWxpZiAobElsbCA8IGxlbih3KSk6CiAgICAgICAgICAgIGxsMWwuYXBwZW5kKHdbbElsbF0pOwogICAgICAgIGxJbGwrPTE7CiAgICAgICAgaWYgKGxsMUkgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQoaVtsbDFJXSkKICAgICAgICBlbGlmIChsbDFJIDwgbGVuKGkpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQoaVtsbDFJXSkKICAgICAgICBsbDFJKz0xOwogICAgICAgIGlmIChJbDFsIDwgNSk6CiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHNbSWwxbF0pCiAgICAgICAgZWxpZiAoSWwxbCA8IGxlbihzKSk6CiAgICAgICAgICAgIGxsMWwuYXBwZW5kKHNbSWwxbF0pOwogICAgICAgIElsMWwrPTE7CiAgICAgICAgaWYgKGxlbih3KSArIGxlbihpKSArIGxlbihzKSArIGxlbihlKSA9PSBsZW4obGwxbCkgKyBsZW4obDFsSSkgKyBsZW4oZSkpOgogICAgICAgICAgICBicmVhazsKICAgICAgICAKICAgIGxJMWwgPSAnJy5qb2luKGxsMWwpIy5qb2luKCcnKTsKICAgIEkxbEkgPSAnJy5qb2luKGwxbEkpIy5qb2luKCcnKTsKICAgIGxsMUkgPSAwOwogICAgbDFsbCA9IFtdOwogICAgZm9yIGxJbGwgaW4gcmFuZ2UoMCxsZW4obGwxbCksMik6CiAgICAgICAgI3ByaW50ICdhcnJheSBpJyxsSWxsLGxlbihsbDFsKQogICAgICAgIGxsMTEgPSAtMTsKICAgICAgICBpZiAoIG9yZChJMWxJW2xsMUldKSAlIDIpOgogICAgICAgICAgICBsbDExID0gMTsKICAgICAgICAjcHJpbnQgJ3ZhbCBpcyAnLCBsSTFsW2xJbGw6IGxJbGwrMl0KICAgICAgICBsMWxsLmFwcGVuZChjaHIoICAgIGludChsSTFsW2xJbGw6IGxJbGwrMl0sIDM2KSAtIGxsMTEpKTsKICAgICAgICBsbDFJKz0xOwogICAgICAgIGlmIChsbDFJID49IGxlbihsMWxJKSk6CiAgICAgICAgICAgIGxsMUkgPSAwOwogICAgcmV0PScnLmpvaW4obDFsbCkKICAgIGlmICdldmFsKGZ1bmN0aW9uKHcsaSxzLGUpJyBpbiByZXQ6CiAgICAgICAgcHJpbnQgJ1NUSUxMIEdPaW5nJwogICAgICAgIHJldD1yZS5jb21waWxlKCdldmFsXChmdW5jdGlvblwodyxpLHMsZVwpLip9XCgoLio/KVwpJykuZmluZGFsbChyZXQpWzBdIAogICAgICAgIHJldHVybiBnZXRfdW53aXNlKHJldCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQgJ0ZJTklTSEVEJwogICAgICAgIHJldHVybiByZXQKICAgIApkZWYgZ2V0X3VucGFja2VkKCBwYWdlX3ZhbHVlLCByZWdleF9mb3JfdGV4dD0nJywgaXRlcmF0aW9ucz0xLCB0b3RhbF9pdGVyYXRpb249MSk6CiAgICB0cnk6ICAgICAgICAKICAgICAgICByZWdfZGF0YT1Ob25lCiAgICAgICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlKQogICAgICAgIHByaW50ICdwYWdlX3ZhbHVlJyxwYWdlX3ZhbHVlCiAgICAgICAgaWYgcmVnZXhfZm9yX3RleHQgYW5kIGxlbihyZWdleF9mb3JfdGV4dCk+MDoKICAgICAgICAgICAgcGFnZV92YWx1ZT1yZS5jb21waWxlKHJlZ2V4X2Zvcl90ZXh0KS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdICNnZXQgdGhlIGpzIHZhcmlhYmxlCiAgICAgICAgCiAgICAgICAgcGFnZV92YWx1ZT11bnBhY2socGFnZV92YWx1ZSxpdGVyYXRpb25zLHRvdGFsX2l0ZXJhdGlvbikKICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICBwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIGlmICdzYXYxbGl2ZS50dicgaW4gcGFnZV92YWx1ZToKICAgICAgICBwYWdlX3ZhbHVlPXBhZ2VfdmFsdWUucmVwbGFjZSgnc2F2MWxpdmUudHYnLCdzYXdsaXZlLnR2JykgI3F1aWNrIGZpeCBzb21lIGJ1ZyBzb21ld2hlcmUKICAgICAgICBwcmludCAnc2F2MSB1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgcmV0dXJuIHBhZ2VfdmFsdWUKCmRlZiB1bnBhY2soc0phdmFzY3JpcHQsaXRlcmF0aW9uPTEsIHRvdGFsaXRlcmF0aW9ucz0yICApOgogICAgcHJpbnQgJ2l0ZXJhdGlvbicsaXRlcmF0aW9uCiAgICBpZiBzSmF2YXNjcmlwdC5zdGFydHN3aXRoKCd2YXIgXzB4Y2I4YT0nKToKICAgICAgICBhU3BsaXQ9c0phdmFzY3JpcHQuc3BsaXQoJ3ZhciBfMHhjYjhhPScpCiAgICAgICAgc3M9Im15YXJyYXk9IithU3BsaXRbMV0uc3BsaXQoImV2YWwoIilbMF0KICAgICAgICBleGVjKHNzKQogICAgICAgIGExPTYyCiAgICAgICAgYzE9aW50KGFTcGxpdFsxXS5zcGxpdCgiLDYyLCIpWzFdLnNwbGl0KCcsJylbMF0pCiAgICAgICAgcDE9bXlhcnJheVswXQogICAgICAgIGsxPW15YXJyYXlbM10KICAgICAgICB3aXRoIG9wZW4oJ3RlbXAgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAgICAgICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKGsxKSkKICAgICAgICAjYWE9MS8wCiAgICBlbHNlOgoKICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gcH0oJyIpCiAgICAgICAgcHJpbnQgYVNwbGl0CiAgICAgICAgCiAgICAgICAgcDEsYTEsYzEsazE9KCcnLCcwJywnMCcsJycpCiAgICAgCiAgICAgICAgc3M9InAxLGExLGMxLGsxPSgnIithU3BsaXRbMV0uc3BsaXQoIi5zcGxpIilbMF0rJyknIAogICAgICAgIGV4ZWMoc3MpCiAgICBrMT1rMS5zcGxpdCgnfCcpCiAgICBhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIikpJyIpCiMgICAgcHJpbnQgJyBwIGFycmF5IGlzICcsbGVuKGFTcGxpdCkKIyAgIHByaW50IGxlbihhU3BsaXQgKQoKICAgICNwPXN0cihhU3BsaXRbMF0rJykpJykjLnJlcGxhY2UoIlxcIiwiIikjLnJlcGxhY2UoJ1xcXFwnLCdcXCcpCgogICAgI3ByaW50IGFTcGxpdFsxXQogICAgI2FTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiLCIpCiAgICAjcHJpbnQgYVNwbGl0WzBdIAogICAgI2EgPSBpbnQoYVNwbGl0WzFdKQogICAgI2MgPSBpbnQoYVNwbGl0WzJdKQogICAgI2sgPSBhU3BsaXRbM10uc3BsaXQoIi4iKVswXS5yZXBsYWNlKCInIiwgJycpLnNwbGl0KCd8JykKICAgICNhPWludChhKQogICAgI2M9aW50KGMpCiAgICAKICAgICNwPXAucmVwbGFjZSgnXFwnLCAnJykKIyAgICBwcmludCAncCB2YWwgaXMgJyxwWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwWy0xMDA6XSxsZW4ocCkKIyAgICBwcmludCAncDEgdmFsIGlzICcscDFbMDoxMDBdLCcuLi4uLi4uLi4uLi4nLHAxWy0xMDA6XSxsZW4ocDEpCiAgICAKICAgICNwcmludCBhLGExCiAgICAjcHJpbnQgYyxhMQogICAgI3ByaW50ICdrIHZhbCBpcyAnLGtbLTEwOl0sbGVuKGspCiMgICAgcHJpbnQgJ2sxIHZhbCBpcyAnLGsxWy0xMDpdLGxlbihrMSkKICAgIGUgPSAnJwogICAgZCA9ICcnIzMyODIzCgogICAgI3NVbnBhY2tlZCA9IHN0cihfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkKSkKICAgIHNVbnBhY2tlZDEgPSBzdHIoX191bnBhY2socDEsIGExLCBjMSwgazEsIGUsIGQsaXRlcmF0aW9uKSkKICAgIAogICAgI3ByaW50IHNVbnBhY2tlZFs6MjAwXSsnLi4uLicrc1VucGFja2VkWy0xMDA6XSwgbGVuKHNVbnBhY2tlZCkKIyAgICBwcmludCBzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpCiAgICAKICAgICNleGVjKCdzVW5wYWNrZWQxPSInK3NVbnBhY2tlZDErJyInKQogICAgaWYgaXRlcmF0aW9uPj10b3RhbGl0ZXJhdGlvbnM6CiMgICAgICAgIHByaW50ICdmaW5hbCByZXMnLHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkKICAgICAgICByZXR1cm4gc1VucGFja2VkMSMucmVwbGFjZSgnXFxcXCcsICdcXCcpCiAgICBlbHNlOgojICAgICAgICBwcmludCAnZmluYWwgcmVzIGZvciB0aGlzIGl0ZXJhdGlvbiBpcycsaXRlcmF0aW9uCiAgICAgICAgcmV0dXJuIHVucGFjayhzVW5wYWNrZWQxLGl0ZXJhdGlvbisxKSMucmVwbGFjZSgnXFwnLCAnJyksaXRlcmF0aW9uKSMucmVwbGFjZSgnXFwnLCAnJyk7I3VucGFjayhzVW5wYWNrZWQucmVwbGFjZSgnXFwnLCAnJykpCgpkZWYgX191bnBhY2socCwgYSwgYywgaywgZSwgZCwgaXRlcmF0aW9uLHY9MSk6CgogICAgI3dpdGggb3BlbignYmVmb3JlIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOgogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkKICAgIHdoaWxlIChjID49IDEpOgogICAgICAgIGMgPSBjIC0xCiAgICAgICAgaWYgKGtbY10pOgogICAgICAgICAgICBhYT1zdHIoX19pdG9hTmV3KGMsIGEpKQogICAgICAgICAgICBpZiB2PT0xOgogICAgICAgICAgICAgICAgcD1yZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApIyBUSElTIElTIEJsb29keSBzbG93IQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcD1maW5kQW5kUmVwbGFjZVdvcmQocCxhYSxrW2NdKQoKICAgICAgICAgICAgI3A9ZmluZEFuZFJlcGxhY2VXb3JkKHAsYWEsa1tjXSkKCiAgICAgICAgICAgIAogICAgI3dpdGggb3BlbignYWZ0ZXIgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAjICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKHApKQogICAgcmV0dXJuIHAKCiMKI2Z1bmN0aW9uIGVxdWFsYXZlbnQgdG8gcmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKQpkZWYgZmluZEFuZFJlcGxhY2VXb3JkKHNvdXJjZV9zdHIsIHdvcmRfdG9fZmluZCxyZXBsYWNlX3dpdGgpOgogICAgc3BsaXRzPU5vbmUKICAgIHNwbGl0cz1zb3VyY2Vfc3RyLnNwbGl0KHdvcmRfdG9fZmluZCkKICAgIGlmIGxlbihzcGxpdHMpPjE6CiAgICAgICAgbmV3X3N0cmluZz1bXQogICAgICAgIGN1cnJlbnRfaW5kZXg9MAogICAgICAgIGZvciBjdXJyZW50X3NwbGl0IGluIHNwbGl0czoKICAgICAgICAgICAgI3ByaW50ICdoZXJlJyxpCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKGN1cnJlbnRfc3BsaXQpCiAgICAgICAgICAgIHZhbD13b3JkX3RvX2ZpbmQjYnkgZGVmYXVsdCBhc3N1bWUgaXQgd2FzIHdyb25nIHRvIHNwbGl0CgogICAgICAgICAgICAjaWYgaXRzIGZpcnN0IG9uZSBhbmQgaXRlbSBpcyBibGFuayB0aGVuIGNoZWNrIG5leHQgaXRlbSBpcyB2YWxpZCBvciBub3QKICAgICAgICAgICAgaWYgY3VycmVudF9pbmRleD09bGVuKHNwbGl0cyktMToKICAgICAgICAgICAgICAgIHZhbD0nJyAjIGxhc3Qgb25lIG5vdGhpbmcgdG8gYXBwZW5kIG5vcm1hbGx5CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBsZW4oY3VycmVudF9zcGxpdCk9PTA6ICNpZiBibGFuayBjaGVjayBuZXh0IG9uZSB3aXRoIGN1cnJlbnQgc3BsaXQgdmFsdWUKICAgICAgICAgICAgICAgICAgICBpZiAoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpOiMgZmlyc3QganVzdCBqdXN0IGNoZWNrIG5leHQKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aAogICAgICAgICAgICAgICAgI25vdCBibGFuaywgdGhlbiBjaGVjayBjdXJyZW50IGVuZHZhbHVlIGFuZCBuZXh0IGZpcnN0IHZhbHVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIChzcGxpdHNbY3VycmVudF9pbmRleF1bLTFdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgYW5kICgoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZXBsYWNlX3dpdGgKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKHZhbCkKICAgICAgICAgICAgY3VycmVudF9pbmRleCs9MQogICAgICAgICNhYWFhPTEvMAogICAgICAgIHNvdXJjZV9zdHI9Jycuam9pbihuZXdfc3RyaW5nKQogICAgcmV0dXJuIHNvdXJjZV9zdHIgICAgICAgIAoKZGVmIF9faXRvYShudW0sIHJhZGl4KToKIyAgICBwcmludCAnbnVtIHJlZCcsbnVtLCByYWRpeAogICAgcmVzdWx0ID0gIiIKICAgIGlmIG51bT09MDogcmV0dXJuICcwJwogICAgd2hpbGUgbnVtID4gMDoKICAgICAgICByZXN1bHQgPSAiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IltudW0gJSByYWRpeF0gKyByZXN1bHQKICAgICAgICBudW0gLz0gcmFkaXgKICAgIHJldHVybiByZXN1bHQKCQpkZWYgX19pdG9hTmV3KGNjLCBhKToKICAgIGFhPSIiIGlmIGNjIDwgYSBlbHNlIF9faXRvYU5ldyhpbnQoY2MgLyBhKSxhKSAKICAgIGNjID0gKGNjICUgYSkKICAgIGJiPWNocihjYyArIDI5KSBpZiBjYz4gMzUgZWxzZSBzdHIoX19pdG9hKGNjLDM2KSkKICAgIHJldHVybiBhYStiYgoKCmRlZiBnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcik6CiAgICB0cnk6CiAgICAgICAgY29va2llU3RyaW5nPSIiCiAgICAgICAgZm9yIGluZGV4LCBjb29raWUgaW4gZW51bWVyYXRlKGNvb2tpZUphcik6CiAgICAgICAgICAgIGNvb2tpZVN0cmluZys9Y29va2llLm5hbWUgKyAiPSIgKyBjb29raWUudmFsdWUgKyI7IgogICAgZXhjZXB0OiBwYXNzCiAgICAjcHJpbnQgJ2Nvb2tpZVN0cmluZycsY29va2llU3RyaW5nCiAgICByZXR1cm4gY29va2llU3RyaW5nCgoKZGVmIHNhdmVDb29raWVKYXIoY29va2llSmFyLENPT0tJRUZJTEUpOgoJdHJ5OgoJCWNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkKCQljb29raWVKYXIuc2F2ZShjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCglleGNlcHQ6IHBhc3MKCmRlZiBnZXRDb29raWVKYXIoQ09PS0lFRklMRSk6CgoJY29va2llSmFyPU5vbmUKCWlmIENPT0tJRUZJTEU6CgkJdHJ5OgoJCQljb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpCgkJCWNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQoJCQljb29raWVKYXIubG9hZChjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCgkJZXhjZXB0OiAKCQkJY29va2llSmFyPU5vbmUKCQoJaWYgbm90IGNvb2tpZUphcjoKCQljb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkKCQoJcmV0dXJuIGNvb2tpZUphcgogICAgCmRlZiBkb0V2YWwoZnVuX2NhbGwscGFnZV9kYXRhLENvb2tpZV9KYXIpOgogICAgcmV0X3ZhbD0nJwogICAgaWYgZnVuY3Rpb25zX2RpciBub3QgaW4gc3lzLnBhdGg6CiAgICAgICAgc3lzLnBhdGguYXBwZW5kKGZ1bmN0aW9uc19kaXIpCiAgICAKICAgIHByaW50IGZ1bl9jYWxsCiAgICB0cnk6CiAgICAgICAgcHlfZmlsZT0naW1wb3J0ICcrZnVuX2NhbGwuc3BsaXQoJy4nKVswXQogICAgICAgIHByaW50IHB5X2ZpbGUsc3lzLnBhdGgKICAgICAgICBleGVjKCBweV9maWxlKQogICAgICAgIHByaW50ICdkb25lJwogICAgZXhjZXB0OgogICAgICAgIHByaW50ICdlcnJvciBpbiBpbXBvcnQnCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsCiAgICBleGVjICgncmV0X3ZhbD0nK2Z1bl9jYWxsKQogICAgcHJpbnQgcmV0X3ZhbAogICAgI2V4ZWMoJ3JldF92YWw9MSsxJykKICAgIHJldHVybiBzdHIocmV0X3ZhbCkKICAgIApkZWYgcHJvY2Vzc1JlY2FwdGNoYSh1cmwpOgoJaHRtbF90ZXh0PWdldFVybCh1cmwpCglyZWNhcENoYWxsZW5nZT0iIgoJc29sdXRpb249IiIKCWNhcF9yZWc9IjxzY3JpcHQuKj9zcmM9XCIoLio/cmVjYXAuKj8pXCIiCgltYXRjaCA9cmUuZmluZGFsbChjYXBfcmVnLCBodG1sX3RleHQpCgljYXB0Y2hhPUZhbHNlCgljYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1Ob25lCglzb2x1dGlvbj1Ob25lCgkKCWlmIG1hdGNoIGFuZCBsZW4obWF0Y2gpPjA6ICNuZXcgc2hpbnkgY2FwdGNoYSEKCQljYXB0Y2hhX3VybD1tYXRjaFswXQoJCWNhcHRjaGE9VHJ1ZQoJCQoJCWNhcF9jaGFsbF9yZWc9J2NoYWxsZW5nZS4qP1wnKC4qPylcJycKCQljYXBfaW1hZ2VfcmVnPSdcJyguKj8pXCcnCgkJY2FwdGNoYV9zY3JpcHQ9Z2V0VXJsKGNhcHRjaGFfdXJsKQoJCXJlY2FwQ2hhbGxlbmdlPXJlLmZpbmRhbGwoY2FwX2NoYWxsX3JlZywgY2FwdGNoYV9zY3JpcHQpWzBdCgkJY2FwdGNoYV9yZWxvYWQ9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3JlbG9hZD9jPSc7CgkJY2FwdGNoYV9rPWNhcHRjaGFfdXJsLnNwbGl0KCdrPScpWzFdCgkJY2FwdGNoYV9yZWxvYWQrPXJlY2FwQ2hhbGxlbmdlKycmaz0nK2NhcHRjaGFfaysnJmNhcHRjaGFfaz0xJnR5cGU9aW1hZ2UmbGFuZz1lbi1HQicKCQljYXB0Y2hhX3JlbG9hZF9qcz1nZXRVcmwoY2FwdGNoYV9yZWxvYWQpCgkJY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9cmUuZmluZGFsbChjYXBfaW1hZ2VfcmVnLCBjYXB0Y2hhX3JlbG9hZF9qcylbMF0KCQljYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvaW1hZ2U/Yz0nK2NhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsCgkJaWYgbm90IGNhcHRjaGFfaW1hZ2VfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKCQkJY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLycrY2FwdGNoYV9pbWFnZV91cmwKCQlpbXBvcnQgcmFuZG9tCgkJbj1yYW5kb20ucmFuZHJhbmdlKDEwMCwxMDAwLDUpCgkJbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLHN0cihuKSArImNhcHRjaGEuaW1nIiApCgkJbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQoJCWxvY2FsRmlsZS53cml0ZShnZXRVcmwoY2FwdGNoYV9pbWFnZV91cmwpKQoJCWxvY2FsRmlsZS5jbG9zZSgpCgkJc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQoJCXNvbHV0aW9uID0gc29sdmVyLmdldCgpCgkJb3MucmVtb3ZlKGxvY2FsX2NhcHRjaGEpCglyZXR1cm4gY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwgLHNvbHV0aW9uCgpkZWYgZ2V0VXJsKHVybCwgY29va2llSmFyPU5vbmUscG9zdD1Ob25lLCB0aW1lb3V0PTIwLCBoZWFkZXJzPU5vbmUpOgoKCgljb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpCglvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCgkjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCglyZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQoJcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMzMuMC4xNzUwLjE1NCBTYWZhcmkvNTM3LjM2JykKCWlmIGhlYWRlcnM6CgkJZm9yIGgsaHYgaW4gaGVhZGVyczoKCQkJcmVxLmFkZF9oZWFkZXIoaCxodikKCglyZXNwb25zZSA9IG9wZW5lci5vcGVuKHJlcSxwb3N0LHRpbWVvdXQ9dGltZW91dCkKCWxpbms9cmVzcG9uc2UucmVhZCgpCglyZXNwb25zZS5jbG9zZSgpCglyZXR1cm4gbGluazsKCmRlZiBnZXRfZGVjb2RlKHN0cixyZWc9Tm9uZSk6CglpZiByZWc6CgkJc3RyPXJlLmZpbmRhbGwocmVnLCBzdHIpWzBdCglzMSA9IHVybGxpYi51bnF1b3RlKHN0clswOiBsZW4oc3RyKS0xXSk7Cgl0ID0gJyc7Cglmb3IgaSBpbiByYW5nZSggbGVuKHMxKSk6CgkJdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pOwoJdD11cmxsaWIudW5xdW90ZSh0KQoJcHJpbnQgdAoJcmV0dXJuIHQKCmRlZiBqYXZhc2NyaXB0VW5Fc2NhcGUoc3RyKToKCWpzPXJlLmZpbmRhbGwoJ3VuZXNjYXBlXChcJyguKj8pXCcnLHN0cikKCXByaW50ICdqcycsanMKCWlmIChub3QganM9PU5vbmUpIGFuZCBsZW4oanMpPjA6CgkJZm9yIGogaW4ganM6CgkJCSNwcmludCB1cmxsaWIudW5xdW90ZShqKQoJCQlzdHI9c3RyLnJlcGxhY2UoaiAsdXJsbGliLnVucXVvdGUoaikpCglyZXR1cm4gc3RyCgppaWQ9MApkZWYgYXNrQ2FwdGNoYShtLGh0bWxfcGFnZSwgY29va2llSmFyKToKICAgIGdsb2JhbCBpaWQKICAgIGlpZCs9MQogICAgZXhwcmU9IG1bJ2V4cHJlJ10KICAgIHBhZ2VfdXJsID0gbVsncGFnZSddCiAgICBjYXB0Y2hhX3JlZ2V4PXJlLmNvbXBpbGUoJ1wkTGl2ZVN0cmVhbUNhcHRjaGFcWyhbXlxdXSopXF0nKS5maW5kYWxsKGV4cHJlKVswXQoKICAgIGNhcHRjaGFfdXJsPXJlLmNvbXBpbGUoY2FwdGNoYV9yZWdleCkuZmluZGFsbChodG1sX3BhZ2UpWzBdCiAgICBwcmludCBleHByZSxjYXB0Y2hhX3JlZ2V4LGNhcHRjaGFfdXJsCiAgICBpZiBub3QgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfPSdodHRwOi8vJysiIi5qb2luKHBhZ2VfdXJsLnNwbGl0KCcvJylbMjozXSkKICAgICAgICBpZiBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCIvIik6CiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfK2NhcHRjaGFfdXJsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rJy8nK2NhcHRjaGFfdXJsCiAgICAKICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApCiAgICBsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpCiAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybAogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KGNhcHRjaGFfdXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpCiAgICBpZiAncmVmZXInIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlciddKQogICAgaWYgJ2FnZW50JyBpbiBtOgogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkKICAgIGlmICdzZXRjb29raWUnIGluIG06CiAgICAgICAgcHJpbnQgJ2FkZGluZyBjb29raWUnLG1bJ3NldGNvb2tpZSddCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQogICAgICAgIAogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKICAgICNvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpCiAgICByZXNwb25zZS5jbG9zZSgpCiAgICBsb2NhbEZpbGUuY2xvc2UoKQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQogICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkKICAgIHJldHVybiBzb2x1dGlvbgogICAgCmNsYXNzIElucHV0V2luZG93KHhibWNndWkuV2luZG93RGlhbG9nKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIHNlbGYuY3B0bG9jID0ga3dhcmdzLmdldCgnY2FwdGNoYScpCiAgICAgICAgc2VsZi5pbWcgPSB4Ym1jZ3VpLkNvbnRyb2xJbWFnZSgzMzUsMzAsNjI0LDYwLHNlbGYuY3B0bG9jKQogICAgICAgIHNlbGYuYWRkQ29udHJvbChzZWxmLmltZykKICAgICAgICBzZWxmLmtiZCA9IHhibWMuS2V5Ym9hcmQoKQoKICAgIGRlZiBnZXQoc2VsZik6CiAgICAgICAgc2VsZi5zaG93KCkKICAgICAgICB0aW1lLnNsZWVwKDIpICAgICAgICAKICAgICAgICBzZWxmLmtiZC5kb01vZGFsKCkKICAgICAgICBpZiAoc2VsZi5rYmQuaXNDb25maXJtZWQoKSk6CiAgICAgICAgICAgIHRleHQgPSBzZWxmLmtiZC5nZXRUZXh0KCkKICAgICAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiB0ZXh0CiAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKZGVmIGdldEVwb2NUaW1lKCk6CiAgICBpbXBvcnQgdGltZQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkqMTAwMCkpCgpkZWYgZ2V0RXBvY1RpbWUyKCk6CiAgICBpbXBvcnQgdGltZQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkpKQoKZGVmIGdldF9wYXJhbXMoKToKICAgICAgICBwYXJhbT1bXQogICAgICAgIHBhcmFtc3RyaW5nPXN5cy5hcmd2WzJdCiAgICAgICAgaWYgbGVuKHBhcmFtc3RyaW5nKT49MjoKICAgICAgICAgICAgcGFyYW1zPXN5cy5hcmd2WzJdCiAgICAgICAgICAgIGNsZWFuZWRwYXJhbXM9cGFyYW1zLnJlcGxhY2UoJz8nLCcnKQogICAgICAgICAgICBpZiAocGFyYW1zW2xlbihwYXJhbXMpLTFdPT0nLycpOgogICAgICAgICAgICAgICAgcGFyYW1zPXBhcmFtc1swOmxlbihwYXJhbXMpLTJdCiAgICAgICAgICAgIHBhaXJzb2ZwYXJhbXM9Y2xlYW5lZHBhcmFtcy5zcGxpdCgnJicpCiAgICAgICAgICAgIHBhcmFtPXt9CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihwYWlyc29mcGFyYW1zKSk6CiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz17fQogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9cGFpcnNvZnBhcmFtc1tpXS5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICBpZiAobGVuKHNwbGl0cGFyYW1zKSk9PTI6CiAgICAgICAgICAgICAgICAgICAgcGFyYW1bc3BsaXRwYXJhbXNbMF1dPXNwbGl0cGFyYW1zWzFdCiAgICAgICAgcmV0dXJuIHBhcmFtCgoKZGVmIGdldEZhdm9yaXRlcygpOgogICAgICAgIGl0ZW1zID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQogICAgICAgIGZvciBpIGluIGl0ZW1zOgogICAgICAgICAgICBuYW1lID0gaVswXQogICAgICAgICAgICB1cmwgPSBpWzFdCiAgICAgICAgICAgIGljb25pbWFnZSA9IGlbMl0KICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZmFuQXJ0ID0gaVszXQogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGljb25pbWFnZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgdHJ5OiBwbGF5bGlzdCA9IGlbNV0KICAgICAgICAgICAgZXhjZXB0OiBwbGF5bGlzdCA9IE5vbmUKICAgICAgICAgICAgdHJ5OiByZWdleHMgPSBpWzZdCiAgICAgICAgICAgIGV4Y2VwdDogcmVnZXhzID0gTm9uZQoKICAgICAgICAgICAgaWYgaVs0XSA9PSAwOgogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuQXJ0LCcnLCcnLCcnLCdmYXYnLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCxpWzRdLGljb25pbWFnZSxmYW5hcnQsJycsJycsJycsJycsJ2ZhdicpCgoKZGVmIGFkZEZhdm9yaXRlKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSxwbGF5bGlzdD1Ob25lLHJlZ2V4cz1Ob25lKToKICAgICAgICBmYXZMaXN0ID0gW10KICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzICsgJ3R4dCcpOgogICAgICAgICAgICBvcy5tYWtlZGlycyhmYXZvcml0ZXMgKyAndHh0JykKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoaGlzdG9yeSk6CiAgICAgICAgICAgIG9zLm1ha2VkaXJzKGhpc3RvcnkpCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIHNlZW1zIHRoYXQgYWZ0ZXIKICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PUZhbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ01ha2luZyBGYXZvcml0ZXMgRmlsZScpCiAgICAgICAgICAgIGZhdkxpc3QuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3QscmVnZXhzKSkKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgIGEud3JpdGUoanNvbi5kdW1wcyhmYXZMaXN0KSkKICAgICAgICAgICAgYS5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdBcHBlbmRpbmcgRmF2b3JpdGVzJykKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkKICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMoYSkKICAgICAgICAgICAgZGF0YS5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSkpCiAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpCiAgICAgICAgICAgIGIuY2xvc2UoKQoKCmRlZiBybUZhdm9yaXRlKG5hbWUpOgogICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihkYXRhKSk6CiAgICAgICAgICAgIGlmIGRhdGFbaW5kZXhdWzBdPT1uYW1lOgogICAgICAgICAgICAgICAgZGVsIGRhdGFbaW5kZXhdCiAgICAgICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkKICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikKCmRlZiB1cmxzb2x2ZXIodXJsKToKICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ1VwZGF0ZWNvbW1vbnJlc29sdmVycycpID09ICd0cnVlJzoKICAgICAgICBsID0gb3MucGF0aC5qb2luKGhvbWUsJ2dlbmVzaXNyZXNvbHZlcnMucHknKQogICAgICAgIGlmIHhibWN2ZnMuZXhpc3RzKGwpOgogICAgICAgICAgICBvcy5yZW1vdmUobCkKCiAgICAgICAgZ2VuZXNpc191cmwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2xhbWJkYTgxL2xhbWJkYS1hZGRvbnMvbWFzdGVyL3BsdWdpbi52aWRlby5nZW5lc2lzL2NvbW1vbnJlc29sdmVycy5weScKICAgICAgICB0aD0gdXJsbGliLnVybHJldHJpZXZlKGdlbmVzaXNfdXJsLGwpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnVXBkYXRlY29tbW9ucmVzb2x2ZXJzJywgJ2ZhbHNlJykKICAgIHRyeToKICAgICAgICBpbXBvcnQgZ2VuZXNpc3Jlc29sdmVycwogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihHZW4tWCxQbGVhc2UgZW5hYmxlIFVwZGF0ZSBDb21tb25yZXNvbHZlcnMgdG8gUGxheSBpbiBTZXR0aW5ncy4gLSAsMTAwMDApIikKCiAgICByZXNvbHZlZD1nZW5lc2lzcmVzb2x2ZXJzLmdldCh1cmwpLnJlc3VsdAogICAgaWYgdXJsID09IHJlc29sdmVkIG9yIHJlc29sdmVkIGlzIE5vbmU6CiAgICAgICAgI2ltcG9ydAogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEdlbi1YLElzIEZpbmRpbmcgWW91ciBMaW5rIC0gLDUwMDApIikKICAgICAgICBpbXBvcnQgcmVzb2x2ZXVybAogICAgICAgIGhvc3QgPSByZXNvbHZldXJsLkhvc3RlZE1lZGlhRmlsZSh1cmwpCiAgICAgICAgaWYgaG9zdDoKICAgICAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZldXJsLnJlc29sdmUodXJsKQogICAgICAgICAgICByZXNvbHZlZCA9IHJlc29sdmVyCiAgICBpZiByZXNvbHZlZCA6CiAgICAgICAgaWYgaXNpbnN0YW5jZShyZXNvbHZlZCxsaXN0KToKICAgICAgICAgICAgZm9yIGsgaW4gcmVzb2x2ZWQ6CiAgICAgICAgICAgICAgICBxdWFsaXR5ID0gYWRkb24uZ2V0U2V0dGluZygncXVhbGl0eScpCiAgICAgICAgICAgICAgICBpZiBrWydxdWFsaXR5J10gPT0gJ0hEJyAgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJ1NEJyA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJzEwODBwJyBhbmQgYWRkb24uZ2V0U2V0dGluZygnMTA4MHBxdWFsaXR5JykgPT0gJ3RydWUnIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmVkCiAgICByZXR1cm4gcmVzb2x2ZXIKZGVmIHBsYXlfcGxheWxpc3QobmFtZSwgbXVfcGxheWxpc3QpOgogICAgICAgIGltcG9ydCB1cmxwYXJzZQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2Fza19wbGF5bGlzdF9pdGVtcycpID09ICd0cnVlJzoKICAgICAgICAgICAgbmFtZXMgPSBbXQogICAgICAgICAgICBmb3IgaSBpbiBtdV9wbGF5bGlzdDoKICAgICAgICAgICAgICAgIGRfbmFtZT11cmxwYXJzZS51cmxwYXJzZShpKS5uZXRsb2MKICAgICAgICAgICAgICAgIGlmIGRfbmFtZSA9PSAnJzoKICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQobmFtZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkKICAgICAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgICAgICAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQogICAgICAgICAgICBpZiBpbmRleCA+PSAwOgogICAgICAgICAgICAgICAgaWYgIiZtb2RlPTE5IiBpbiBtdV9wbGF5bGlzdFtpbmRleF06CiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKSkpCiAgICAgICAgICAgICAgICBlbGlmICIkZG9yZWdleCIgaW4gbXVfcGxheWxpc3RbaW5kZXhdIDoKCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpCgogICAgICAgICAgICAgICAgICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHNlcGF0ZVsxXSwgc2VwYXRlWzBdKQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHVybCA9IG11X3BsYXlsaXN0W2luZGV4XQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGxheWxpc3QgPSB4Ym1jLlBsYXlMaXN0KDEpICMgMSBtZWFucyB2aWRlbwogICAgICAgICAgICBwbGF5bGlzdC5jbGVhcigpCiAgICAgICAgICAgIGl0ZW0gPSAwCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgaXRlbSArPSAxCiAgICAgICAgICAgICAgICBpbmZvID0geGJtY2d1aS5MaXN0SXRlbSgnJXMpICVzJyAlKHN0cihpdGVtKSxuYW1lKSkKICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChpLCBpbmZvKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigncGxheWxpc3QucGxheW9mZnNldCh2aWRlbywwKScpCgoKZGVmIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKToKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJykgPT0gIiI6CiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKCdHZW4tWCcsJ0Nob29zZSBhIGxvY2F0aW9uIHRvIHNhdmUgZmlsZXMuJywxNTAwMCwiK2ljb24rIikiKQogICAgICAgICAgICBhZGRvbi5vcGVuU2V0dGluZ3MoKQogICAgICAgIHBhcmFtcyA9IHsndXJsJzogdXJsLCAnZG93bmxvYWRfcGF0aCc6IGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKX0KICAgICAgICBkb3dubG9hZGVyLmRvd25sb2FkKG5hbWUsIHBhcmFtcykKICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgcmV0ID0gZGlhbG9nLnllc25vKCdHZW4tWCcsICdEbyB5b3Ugd2FudCB0byBhZGQgdGhpcyBmaWxlIGFzIGEgc291cmNlPycpCiAgICAgICAgaWYgcmV0OgogICAgICAgICAgICBhZGRTb3VyY2Uob3MucGF0aC5qb2luKGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSwgbmFtZSkpCgoKZGVmIGFkZERpcihuYW1lLHVybCxtb2RlLGljb25pbWFnZSxmYW5hcnQsZGVzY3JpcHRpb24sZ2VucmUsZGF0ZSxjcmVkaXRzLHNob3djb250ZXh0PUZhbHNlKToKICAgICAgICAKICAgICAgICB1PXN5cy5hcmd2WzBdKyI/dXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9IitzdHIobW9kZSkrIiZuYW1lPSIrdXJsbGliLnF1b3RlX3BsdXMobmFtZSkrIiZpY29uaW1hZ2U9Iit1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpKyImZmFuYXJ0PSIrdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KQogICAgICAgIG9rPVRydWUKICAgICAgICBpZiBkYXRlID09ICcnOgogICAgICAgICAgICBkYXRlID0gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlCiAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSJEZWZhdWx0Rm9sZGVyLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkKICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUsICJjcmVkaXRzIjogY3JlZGl0cyB9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQogICAgICAgIGlmIHNob3djb250ZXh0OgogICAgICAgICAgICBjb250ZXh0TWVudSA9IFtdCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdzb3VyY2UnOgogICAgICAgICAgICAgICAgaWYgbmFtZSBpbiBzdHIoU09VUkNFUyk6CiAgICAgICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnUmVtb3ZlIGZyb20gU291cmNlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9OCZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZG93bmxvYWQnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRG93bmxvYWQnLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT05Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdmYXYnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnUmVtb3ZlIGZyb20gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKCQkJCQkJCQkJCiAgICAgICAgICAgIGlmIG5vdCBuYW1lIGluIEZBVjoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCksIG1vZGUpKSkKICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpCiAgICAgICAgb2s9eGJtY3BsdWdpbi5hZGREaXJlY3RvcnlJdGVtKGhhbmRsZT1pbnQoc3lzLmFyZ3ZbMV0pLHVybD11LGxpc3RpdGVtPWxpeixpc0ZvbGRlcj1UcnVlKQoKICAgICAgICByZXR1cm4gb2sKZGVmIHl0ZGxfZG93bmxvYWQodXJsLHRpdGxlLG1lZGlhX3R5cGU9J3ZpZGVvJyk6CiAgICAjIHBsYXkgaW4geGJtYyB3aGlsZSBwbGF5aW5nIGdvIGJhY2sgdG8gY29udGV4dE1lbnUoYykgdG8gIiEhRG93bmxvYWQhISIKICAgICMgVHJpYWwgeWFzY2Vlbjogc2VwZXJhdGUgfFVzZXItQWdlbnQ9CiAgICBpbXBvcnQgeW91dHViZWRsCiAgICBpZiBub3QgdXJsID09ICcnOgogICAgICAgIGlmIG1lZGlhX3R5cGU9PSAnYXVkaW8nOgogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlLGF1ZGlvPVRydWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCh1cmwsZG93bmxvYWQ9VHJ1ZSkgICAKICAgIGVsaWYgeGJtYy5QbGF5ZXIoKS5pc1BsYXlpbmcoKSA9PSBUcnVlIDoKICAgICAgICBpbXBvcnQgWURTdHJlYW1FeHRyYWN0b3IKICAgICAgICBpZiBZRFN0cmVhbUV4dHJhY3Rvci5pc0Rvd25sb2FkaW5nKCkgPT0gVHJ1ZToKCiAgICAgICAgICAgIFlEU3RyZWFtRXh0cmFjdG9yLm1hbmFnZURvd25sb2FkcygpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jLlBsYXllcigpLmdldFBsYXlpbmdGaWxlKCkKCiAgICAgICAgICAgIHhibWNfdXJsID0geGJtY191cmwuc3BsaXQoJ3xVc2VyLUFnZW50PScpWzBdCiAgICAgICAgICAgIGluZm8gPSB7J3VybCc6eGJtY191cmwsJ3RpdGxlJzp0aXRsZSwnbWVkaWFfdHlwZSc6bWVkaWFfdHlwZX0KICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCgnJyxkb3dubG9hZD1UcnVlLGRsX2luZm89aW5mbykgICAgCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERPV05MT0FELEZpcnN0IFBsYXkgW0NPTE9SIHllbGxvd11XSElMRSBwbGF5aW5nIGRvd25sb2FkWy9DT0xPUl0gLDEwMDAwKSIpCiAKZGVmIHNlYXJjaChzaXRlX25hbWUsc2VhcmNoX3Rlcm09Tm9uZSk6CiAgICB0aHVtYm5haWw9JycKICAgIGlmIG9zLnBhdGguZXhpc3RzKGhpc3RvcnkpID09IEZhbHNlIG9yIGFkZG9uLmdldFNldHRpbmcoJ2NsZWFyc2VhY2hoaXN0b3J5Jyk9PSd0cnVlJzoKICAgICAgICBTYXZlVG9GaWxlKGhpc3RvcnksJycpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygiY2xlYXJzZWFjaGhpc3RvcnkiLCJmYWxzZSIpCiAgICBpZiBzaXRlX25hbWUgPT0gJ2hpc3RvcnknIDoKICAgICAgICBjb250ZW50ID0gTG9hZEZpbGUoaGlzdG9yeSkKICAgICAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJyguKz8pOiguKj8pKD86XHJ8XG4pJykuZmluZGFsbChjb250ZW50KQoKICAgICAgICBmb3IgbmFtZSxzZWFyY2hfdGVybSBpbiBtYXRjaDoKICAgICAgICAgICAgaWYgJ3BsdWdpbjovLycgaW4gc2VhcmNoX3Rlcm06CiAgICAgICAgICAgICAgICBhZGRMaW5rKHNlYXJjaF90ZXJtLCBuYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsPWludChsZW4obWF0Y2gpKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lKyc6JytzZWFyY2hfdGVybSxuYW1lLDI2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgaWYgbm90IHNlYXJjaF90ZXJtOiAgICAKICAgICAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoJycsJ0VudGVyIFNlYXJjaCBUZXJtJykKICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkKICAgICAgICBpZiAoa2V5Ym9hcmQuaXNDb25maXJtZWQoKSA9PSBGYWxzZSk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHNlYXJjaF90ZXJtID0ga2V5Ym9hcmQuZ2V0VGV4dCgpCiAgICAgICAgaWYgbGVuKHNlYXJjaF90ZXJtKSA9PSAwOgogICAgICAgICAgICByZXR1cm4gICAgICAgIAogICAgc2VhcmNoX3Rlcm0gPSBzZWFyY2hfdGVybS5yZXBsYWNlKCcgJywnKycpCiAgICBzZWFyY2hfdGVybSA9IHNlYXJjaF90ZXJtLmVuY29kZSgndXRmLTgnKQogICAgaWYgJ3lvdXR1YmUnIGluIHNpdGVfbmFtZToKICAgICAgICAjeW91dHViZSA9IHlvdXR1YmUjTGFuYSBEZWwgUmV5CiAgICAgICAgaW1wb3J0IF95dHBsaXN0CgogICAgICAgIHNlYXJjaF9yZXMgPSB7fQogICAgICAgIHNlYXJjaF9yZXMgPSBfeXRwbGlzdC5Zb1VUdWJlKCdzZWFyY2hZVCcseW91dHViZT1zZWFyY2hfdGVybSxtYXhfcGFnZT00LG5vc2F2ZT0nbm9zYXZlJykKICAgICAgICB0b3RhbCA9IGxlbihzZWFyY2hfcmVzKQogICAgICAgIGZvciBpdGVtIGluIHNlYXJjaF9yZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hbWUgPSBzZWFyY2hfcmVzW2l0ZW1dWyd0aXRsZSddCiAgICAgICAgICAgICAgICBkYXRlPSBzZWFyY2hfcmVzW2l0ZW1dWydkYXRlJ10KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHNlYXJjaF9yZXNbaXRlbV1bJ2Rlc2MnXQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdVTkFWQUlBQkxFJwoKICAgICAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nICsgc2VhcmNoX3Jlc1tpdGVtXVsndXJsJ10KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9J2h0dHA6Ly9pbWcueW91dHViZS5jb20vdmkvJytzZWFyY2hfcmVzW2l0ZW1dWyd1cmwnXSsnLzAuanBnJwogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsIG5hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIAlhZGRvbl9sb2coICdUaGlzIGl0ZW0gaXMgaWdub3JlZDo6JykKICAgICAgICBwYWdlX2RhdGEgPSBzaXRlX25hbWUgKyc6Jysgc2VhcmNoX3Rlcm0gKyAnXG4nCiAgICAgICAgU2F2ZVRvRmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnaGlzdG9yeScpLHBhZ2VfZGF0YSxhcHBlbmQ9VHJ1ZSkKICAgIGVsaWYgJ2Rtb3Rpb24nIGluIHNpdGVfbmFtZToKICAgICAgICB1cmxNYWluID0gImh0dHBzOi8vYXBpLmRhaWx5bW90aW9uLmNvbSIgCiAgICAgICAgI3lvdXR1YmUgPSB5b3V0dWJlI0xhbmEgRGVsIFJleQogICAgICAgIGltcG9ydCBfRE1zZWFyY2gKICAgICAgICBmYW1pbHlGaWx0ZXIgPSBzdHIoYWRkb24uZ2V0U2V0dGluZygnZmFtaWx5RmlsdGVyJykpCiAgICAgICAgX0RNc2VhcmNoLmxpc3RWaWRlb3ModXJsTWFpbisiL3ZpZGVvcz9maWVsZHM9ZGVzY3JpcHRpb24sZHVyYXRpb24saWQsb3duZXIudXNlcm5hbWUsdGFrZW5fdGltZSx0aHVtYm5haWxfbGFyZ2VfdXJsLHRpdGxlLHZpZXdzX3RvdGFsJnNlYXJjaD0iK3NlYXJjaF90ZXJtKyImc29ydD1yZWxldmFuY2UmbGltaXQ9MTAwJmZhbWlseV9maWx0ZXI9IitmYW1pbHlGaWx0ZXIrIiZsb2NhbGl6YXRpb249ZW5fRU4mcGFnZT0xIikKICAgIAogICAgICAgIHBhZ2VfZGF0YSA9IHNpdGVfbmFtZSArJzonKyBzZWFyY2hfdGVybSsgJ1xuJwogICAgICAgIFNhdmVUb0ZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ2hpc3RvcnknKSxwYWdlX2RhdGEsYXBwZW5kPVRydWUpICAgICAgICAKICAgIGVsaWYgJ0lNREJpZHBsYXknIGluIHNpdGVfbmFtZToKICAgICAgICB1cmxNYWluID0gImh0dHA6Ly93d3cub21kYmFwaS5jb20vP3Q9IiAKICAgICAgICB1cmw9IHVybE1haW4rc2VhcmNoX3Rlcm0KCiAgICAgICAgaGVhZGVycyA9IGRpY3QoeydVc2VyLUFnZW50JzonTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4zOyBydjozMy4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzMzLjAnLCdSZWZlcmVyJzogJ2h0dHA6Ly9qb2tlci5vcmcvJywnQWNjZXB0LUVuY29kaW5nJzonZ3ppcCwgZGVmbGF0ZScsJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnLCdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qJ30pCiAgICAKICAgICAgICByPXJlcXVlc3RzLmdldCh1cmwsaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGRhdGEgPSByLmpzb24oKQogICAgICAgIHJlcyA9IGRhdGFbJ1Jlc3BvbnNlJ10KICAgICAgICBpZiByZXMgPT0gJ1RydWUnOgogICAgICAgICAgICBpbWRiSUQgPSBkYXRhWydpbWRiSUQnXQogICAgICAgICAgICBuYW1lPSBkYXRhWydUaXRsZSddICsgZGF0YVsnUmVsZWFzZWQnXQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgICAgIHJldCA9IGRpYWxvZy55ZXNubygnQ2hlY2sgTW92aWUgVGl0bGUnLCAnUExBWSA6OiAlcyA/JyVuYW1lKQogICAgICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS8nK2ltZGJJRCsnL3BsYXknCiAgICAgICAgICAgICAgICBwYWdlX2RhdGEgPSBuYW1lICsnOicrIHVybCsgJ1xuJwogICAgICAgICAgICAgICAgU2F2ZVRvRmlsZShoaXN0b3J5LHBhZ2VfZGF0YSxhcHBlbmQ9VHJ1ZSkKICAgICAgICAgICAgICAgIHJldHVybiB1cmwKICAgICAgICBlbHNlOgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTaW1wbGVLb3JlLE5vIElNREIgbWF0Y2ggZm91bmQgLDcwMDAsIitpY29uKyIpIikKIyMgTHVuYXRpeHogUHNldWRvVFYgZmVhdHVyZQpkZWYgYXNjaWkoc3RyaW5nKToKICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCBiYXNlc3RyaW5nKToKICAgICAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6CiAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykKICAgIHJldHVybiBzdHJpbmcKZGVmIHVuaShzdHJpbmcsIGVuY29kaW5nID0gJ3V0Zi04Jyk6CiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uoc3RyaW5nLCB1bmljb2RlKToKICAgICAgICAgICAgc3RyaW5nID0gdW5pY29kZShzdHJpbmcsIGVuY29kaW5nLCAnaWdub3JlJykKICAgIHJldHVybiBzdHJpbmcKZGVmIHJlbW92ZU5vbkFzY2lpKHMpOiByZXR1cm4gIiIuam9pbihmaWx0ZXIobGFtYmRhIHg6IG9yZCh4KTwxMjgsIHMpKQoKZGVmIHNlbmRKU09OKCBjb21tYW5kKToKICAgIGRhdGEgPSAnJwogICAgdHJ5OgogICAgICAgIGRhdGEgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKHVuaShjb21tYW5kKSkKICAgIGV4Y2VwdCBVbmljb2RlRW5jb2RlRXJyb3I6CiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEMoYXNjaWkoY29tbWFuZCkpCgogICAgcmV0dXJuIHVuaShkYXRhKQoKI2hha2FtYWMgdGhhbmtzIFJvbWFuX1ZfTQpkZWYgU2V0Vmlld1RodW1ibmFpbCgpOgogICAgc2tpbl91c2VkID0geGJtYy5nZXRTa2luRGlyKCkKICAgIGlmIHNraW5fdXNlZCA9PSAnc2tpbi5jb25mbHVlbmNlJzoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKScpCiAgICBlbGlmIHNraW5fdXNlZCA9PSAnc2tpbi5hZW9uLm5veCc6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUxMSknKSAKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCknKQoJCgkKZGVmIHBsdWdpbnF1ZXJ5YnlKU09OKHVybCk6CiAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOnsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwicHJvcGVydGllcyI6WyJ0aHVtYm5haWwiLCJ0aXRsZSIsInllYXIiLCJkYXRlYWRkZWQiLCJmYW5hcnQiLCJyYXRpbmciLCJzZWFzb24iLCJlcGlzb2RlIiwic3R1ZGlvIl19LCJpZCI6MX0nKSAldXJsCgogICAganNvbl9mb2xkZXJfZGV0YWlsID0ganNvbi5sb2FkcyhzZW5kSlNPTihqc29uX3F1ZXJ5KSkKICAgIGZvciBpIGluIGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10gOgogICAgICAgIHVybCA9IGlbJ2ZpbGUnXQogICAgICAgIG5hbWUgPSByZW1vdmVOb25Bc2NpaShpWydsYWJlbCddKQogICAgICAgIHRodW1ibmFpbCA9IHJlbW92ZU5vbkFzY2lpKGlbJ3RodW1ibmFpbCddKQogICAgICAgIHRyeToKICAgICAgICAgICAgZmFuYXJ0ID0gcmVtb3ZlTm9uQXNjaWkoaVsnZmFuYXJ0J10pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZmFuYXJ0ID0gJycKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRhdGUgPSBpWyd5ZWFyJ10KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBkYXRlID0gJycKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVwaXNvZGUgPSBpWydlcGlzb2RlJ10KICAgICAgICAgICAgc2Vhc29uID0gaVsnc2Vhc29uJ10KICAgICAgICAgICAgaWYgZXBpc29kZSA9PSAtMSBvciBzZWFzb24gPT0gLTE6CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICcnCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdbQ09MT1IgeWVsbG93XSBTJyArIHN0cihzZWFzb24pKydbL0NPTE9SXVtDT0xPUiBob3RwaW5rXSBFJyArIHN0cihlcGlzb2RlKSArJ1svQ09MT1JdJwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJycKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN0dWRpbyA9IGlbJ3N0dWRpbyddCiAgICAgICAgICAgIGlmIHN0dWRpbzoKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcbiBTdHVkaW86W0NPTE9SIHN0ZWVsYmx1ZV0gJyArIHN0dWRpb1swXSArICdbL0NPTE9SXScKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBzdHVkaW8gPSAnJwoKICAgICAgICBpZiBpWydmaWxldHlwZSddID09ICdmaWxlJzoKICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSx0aHVtYm5haWwsZmFuYXJ0LGRlc2NyaXB0aW9uLCcnLGRhdGUsJycsTm9uZSwnJyx0b3RhbD1sZW4oanNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSkpCiAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCw1Myx0aHVtYm5haWwsZmFuYXJ0LGRlc2NyaXB0aW9uLCcnLGRhdGUsJycpCiAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpCgpkZWYgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsc2hvd2NvbnRleHQscGxheWxpc3QscmVnZXhzLHRvdGFsLHNldENvb2tpZT0iIik6CiAgICAgICAgI3ByaW50ICd1cmwsbmFtZScsdXJsLG5hbWUKICAgICAgICBjb250ZXh0TWVudSA9W10KICAgICAgICB0cnk6CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgIG9rID0gVHJ1ZQogICAgICAgCiAgICAgICAgaWYgcmVnZXhzOiAKICAgICAgICAgICAgbW9kZSA9ICcxNycKICAgICAgICAgICAKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAKICAgICAgICBlbGlmICBhbnkoeCBpbiB1cmwgZm9yIHggaW4gcmVzb2x2ZV91cmwpIGFuZCAgdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgbW9kZSA9ICcxOScKICAgICAgICAgIAogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgICAgICAgICAgIAogICAgICAgIGVsaWYgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOCcpOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTE4JywnJykKICAgICAgICAgICAgbW9kZSA9ICcxOCcgCiAgICAgICAgICAKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQhIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjMmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpIAogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdkbGF1ZGlvb25seScpID09ICd0cnVlJzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJyEhRG93bmxvYWQgW0NPTE9SIHNlYWJsdWVdQXVkaW8hIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjQmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpIG9yICcudG9ycmVudCcgaW4gdXJsOgogICAgICAgICAgCiAgICAgICAgICAgIGlmICcmJyBpbiB1cmwgYW5kIG5vdCAnJmFtcDsnIGluIHVybCA6CiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnJicsJyZhbXA7JykKICAgICAgICAgICAgdXJsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wdWxzYXIvcGxheT91cmk9JyArIHVybAogICAgICAgICAgICBtb2RlID0gJzEyJwogICAgICAgICAgICAgICAgICAgICAKICAgICAgICBlbHNlOiAKICAgICAgICAgICAgbW9kZSA9ICcxMicKICAgICAgCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgCiAgICAgICAgdT1zeXMuYXJndlswXSsiPyIKICAgICAgICBwbGF5X2xpc3QgPSBGYWxzZQogICAgICAKICAgICAgICBpZiBwbGF5bGlzdDoKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykgPT0gImZhbHNlIjoKICAgICAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdSArPSAibW9kZT0xMyZuYW1lPSVzJnBsYXlsaXN0PSVzIiAlKHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgJ1tDT0xPUiBtYWdlbnRhXSAoJyArIHN0cihsZW4ocGxheWxpc3QpKSArICcgaXRlbXMgKVsvQ09MT1JdJwogICAgICAgICAgICAgICAgcGxheV9saXN0ID0gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQogICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgdSArPSAiJnJlZ2V4cz0iK3JlZ2V4cwogICAgICAgIGlmIG5vdCBzZXRDb29raWUgPT0gJyc6CiAgICAgICAgICAgIHUgKz0gIiZzZXRDb29raWU9Iit1cmxsaWIucXVvdGVfcGx1cyhzZXRDb29raWUpCiAgCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoKICAgICAgICAgICAgZGF0ZSA9IE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkKICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUgfSkKICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkKICAgICAgICAKICAgICAgICBpZiAobm90IHBsYXlfbGlzdCkgYW5kIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6IyAgKG5vdCB1cmwuc3RhcnRzd2l0aCgncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlcicpKToKICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgYW5kICdub3RwbGF5YWJsZScgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSAgOgogICAgICAgICAgICAgICAgICAgICNwcmludCAnc2V0dGluZyBpc3BsYXlhYmxlJyx1cmwsIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSx1cmwKICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCAnTk9UIHNldHRpbmcgaXNwbGF5YWJsZScrdXJsKQogICAgICAgCiAgICAgICAgaWYgc2hvd2NvbnRleHQ6CiAgICAgICAgICAgIGNvbnRleHRNZW51ID0gW10KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgKCdSZW1vdmUgZnJvbSBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpCiAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxpZiBub3QgbmFtZSBpbiBGQVY6CiAgICAgICAgICAgICAgICBmYXZfcGFyYW1zID0gKAogICAgICAgICAgICAgICAgICAgICclcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0wJwogICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gJ3BsYXlsaXN0PScrdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkKICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICImcmVnZXhzPSIrcmVnZXhzCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdBZGQgdG8gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzKScgJWZhdl9wYXJhbXMpKQogICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudSkKICAgICAgIAogICAgICAgIGlmIG5vdCBwbGF5bGlzdCBpcyBOb25lOgogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgcGxheWxpc3RfbmFtZSA9IG5hbWUuc3BsaXQoJykgJylbMV0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51XyA9IFsKICAgICAgICAgICAgICAgICAgICAoJ1BsYXkgJytwbGF5bGlzdF9uYW1lKycgUGxheUxpc3QnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMpJwogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhwbGF5bGlzdF9uYW1lKSwgdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkpKQogICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudV8pCiAgICAgICAgI3ByaW50ICdhZGRpbmcnLG5hbWUKICMgICAgICAgcHJpbnQgdXJsLHRvdGFsaXRlbXMKICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LHRvdGFsSXRlbXM9dG90YWwpCiAgICAgICAgI3ByaW50ICdhZGRlZCcsbmFtZQogICAgICAgIHJldHVybiBvawoKZGVmIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQ9VHJ1ZSk6CiAgICBpZiBzZXRyZXNvbHZlZDoKICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOm5hbWV9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQogICAgICAgIGxpei5zZXRQYXRoKHN0cih1cmwpKQogICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgbGl6KQogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpICAgICAgCgoKIyMgVGhhbmtzIHRvIGRhc2NoYWNrYSwgYW4gZXBnIHNjcmFwZXIgZm9yIGh0dHA6Ly9pLnRlbGVib3kuY2gvcHJvZ3JhbW0vc3RhdGlvbl9zZWxlY3QucGhwCiMjICBodHRwOi8vZm9ydW0ueGJtYy5vcmcvcG9zdC5waHA/cD05MzYyMjgmcG9zdGNvdW50PTEwNzYKZGVmIGdldGVwZyhsaW5rKToKICAgICAgICB1cmw9dXJsbGliLnVybG9wZW4obGluaykKICAgICAgICBzb3VyY2U9dXJsLnJlYWQoKQogICAgICAgIHVybC5jbG9zZSgpCiAgICAgICAgc291cmNlMiA9IHNvdXJjZS5zcGxpdCgiSmV0enQiKQogICAgICAgIHNvdXJjZTMgPSBzb3VyY2UyWzFdLnNwbGl0KCdwcm9ncmFtbS9kZXRhaWwucGhwP2NvbnN0X2lkPScpCiAgICAgICAgc291cmNldWhyemVpdCA9IHNvdXJjZTNbMV0uc3BsaXQoJzxiciAvPjxhIGhyZWY9Ii8nKQogICAgICAgIG5vd3RpbWUgPSBzb3VyY2V1aHJ6ZWl0WzBdWzQwOmxlbihzb3VyY2V1aHJ6ZWl0WzBdKV0KICAgICAgICBzb3VyY2V0aXRsZSA9IHNvdXJjZTNbMl0uc3BsaXQoIjwvYT48L3A+PC9kaXY+IikKICAgICAgICBub3d0aXRsZSA9IHNvdXJjZXRpdGxlWzBdWzE3Omxlbihzb3VyY2V0aXRsZVswXSldCiAgICAgICAgbm93dGl0bGUgPSBub3d0aXRsZS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICByZXR1cm4gIiAgLSAiK25vd3RpdGxlKyIgLSAiK25vd3RpbWUKCgpkZWYgZ2V0X2VwZyh1cmwsIHJlZ2V4KToKICAgICAgICBkYXRhID0gbWFrZVJlcXVlc3QodXJsKQogICAgICAgIHRyeToKICAgICAgICAgICAgaXRlbSA9IHJlLmZpbmRhbGwocmVnZXgsIGRhdGEpWzBdCiAgICAgICAgICAgIHJldHVybiBpdGVtCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IGZhaWxlZCcpCiAgICAgICAgICAgIGFkZG9uX2xvZyhyZWdleCkKICAgICAgICAgICAgcmV0dXJuCgoKeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICdtb3ZpZXMnKQoKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfVU5TT1JURUQpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfTEFCRUwpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfREFURSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9HRU5SRSkKZXhjZXB0OgogICAgcGFzcwoKcGFyYW1zPWdldF9wYXJhbXMoKQoKdXJsPU5vbmUKbmFtZT1Ob25lCm1vZGU9Tm9uZQpwbGF5bGlzdD1Ob25lCmljb25pbWFnZT1Ob25lCmZhbmFydD1GQU5BUlQKcGxheWxpc3Q9Tm9uZQpmYXZfbW9kZT1Ob25lCnJlZ2V4cz1Ob25lCgp0cnk6CiAgICB1cmw9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInVybCJdKS5kZWNvZGUoJ3V0Zi04JykKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBuYW1lPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJuYW1lIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgaWNvbmltYWdlPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJpY29uaW1hZ2UiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBmYW5hcnQ9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbImZhbmFydCJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIG1vZGU9aW50KHBhcmFtc1sibW9kZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHBsYXlsaXN0PWV2YWwodXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInBsYXlsaXN0Il0pLnJlcGxhY2UoJ3x8JywnLCcpKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGZhdl9tb2RlPWludChwYXJhbXNbImZhdl9tb2RlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgcmVnZXhzPXBhcmFtc1sicmVnZXhzIl0KZXhjZXB0OgogICAgcGFzcwoKYWRkb25fbG9nKCJNb2RlOiAiK3N0cihtb2RlKSkKaWYgbm90IHVybCBpcyBOb25lOgogICAgYWRkb25fbG9nKCJVUkw6ICIrc3RyKHVybC5lbmNvZGUoJ3V0Zi04JykpKQphZGRvbl9sb2coIk5hbWU6ICIrc3RyKG5hbWUpKQoKaWYgbW9kZT09Tm9uZToKICAgIGFkZG9uX2xvZygiSW5kZXgiKQogICAgU0tpbmRleCgpCQoKZWxpZiBtb2RlPT0xOgogICAgYWRkb25fbG9nKCJnZXREYXRhIikKICAgIGdldERhdGEodXJsLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MjoKICAgIGFkZG9uX2xvZygiZ2V0Q2hhbm5lbEl0ZW1zIikKICAgIGdldENoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTM6CiAgICBhZGRvbl9sb2coImdldFN1YkNoYW5uZWxJdGVtcyIpCiAgICBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT00OgogICAgYWRkb25fbG9nKCJnZXRGYXZvcml0ZXMiKQogICAgZ2V0RmF2b3JpdGVzKCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09NToKICAgIGFkZG9uX2xvZygiYWRkRmF2b3JpdGUiKQogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdcXCAnKVsxXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxmYXZfbW9kZSkKCmVsaWYgbW9kZT09NjoKICAgIGFkZG9uX2xvZygicm1GYXZvcml0ZSIpCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICBybUZhdm9yaXRlKG5hbWUpCgplbGlmIG1vZGU9PTc6CiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpCiAgICBhZGRTb3VyY2UodXJsKQoKZWxpZiBtb2RlPT04OgogICAgYWRkb25fbG9nKCJybVNvdXJjZSIpCiAgICBybVNvdXJjZShuYW1lKQoKZWxpZiBtb2RlPT05OgogICAgYWRkb25fbG9nKCJkb3dubG9hZF9maWxlIikKICAgIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKQoKZWxpZiBtb2RlPT0xMDoKICAgIGFkZG9uX2xvZygiZ2V0Q29tbXVuaXR5U291cmNlcyIpCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKCkKCmVsaWYgbW9kZT09MTE6CiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpCiAgICBhZGRTb3VyY2UodXJsKQoKZWxpZiBtb2RlPT0xMjoKICAgIGFkZG9uX2xvZygic2V0UmVzb2x2ZWRVcmwiKQogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4iKSBvciBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiNub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIiKSA6CiAgICAgICAgaXRlbSA9IHhibWNndWkuTGlzdEl0ZW0ocGF0aD11cmwpCiAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBpdGVtKQogICAgZWxzZToKICAgICAgICBwcmludCAnTm90IHNldHRpbmcgc2V0UmVzb2x2ZWRVcmwnCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKQoKCmVsaWYgbW9kZT09MTM6CiAgICBhZGRvbl9sb2coInBsYXlfcGxheWxpc3QiKQogICAgcGxheV9wbGF5bGlzdChuYW1lLCBwbGF5bGlzdCkKCmVsaWYgbW9kZT09MTQ6CiAgICBhZGRvbl9sb2coImdldF94bWxfZGF0YWJhc2UiKQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE1OgogICAgYWRkb25fbG9nKCJicm93c2VfeG1sX2RhdGFiYXNlIikKICAgIGdldF94bWxfZGF0YWJhc2UodXJsLCBUcnVlKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0xNjoKICAgIGFkZG9uX2xvZygiYnJvd3NlX2NvbW11bml0eSIpCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKFRydWUpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE3OgogICAgYWRkb25fbG9nKCJnZXRSZWdleFBhcnNlZCIpCiAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkKICAgIGlmIHVybDoKICAgICAgICBwbGF5c2V0cmVzb2x2ZWQodXJsLG5hbWUsaWNvbmltYWdlLHNldHJlc29sdmVkKQogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihHZW4tWCxGYWlsZWQgdG8gZXh0cmFjdCByZWdleC4gLSAiKyJ0aGlzIisiLDQwMDAsIitpY29uKyIpIikKZWxpZiBtb2RlPT0xODoKICAgIGFkZG9uX2xvZygieW91dHViZWRsIikKICAgIHRyeToKICAgICAgICBpbXBvcnQgeW91dHViZWRsCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEdlbi1YLFBsZWFzZSBbQ09MT1IgeWVsbG93XWluc3RhbGwgdGhlIFlvdXR1YmUgQWRkb25bL0NPTE9SXSBtb2R1bGUgLDEwMDAwLCIiKSIpCiAgICBzdHJlYW1fdXJsPXlvdXR1YmVkbC5zaW5nbGVfWUQodXJsKQogICAgcGxheXNldHJlc29sdmVkKHN0cmVhbV91cmwsbmFtZSxpY29uaW1hZ2UpCmVsaWYgbW9kZT09MTk6CglhZGRvbl9sb2coIkdlbmVzaXNjb21tb25yZXNvbHZlcnMiKQoJcGxheXNldHJlc29sdmVkICh1cmxzb2x2ZXIodXJsKSxuYW1lLGljb25pbWFnZSxUcnVlKQkKCmVsaWYgbW9kZT09MjE6CiAgICBhZGRvbl9sb2coImRvd25sb2FkIGN1cnJlbnQgZmlsZSB1c2luZyB5b3V0dWJlLWRsIHNlcnZpY2UiKQogICAgeXRkbF9kb3dubG9hZCgnJyxuYW1lLCd2aWRlbycpCmVsaWYgbW9kZT09MjM6CiAgICBhZGRvbl9sb2coImdldCBpbmZvIHRoZW4gZG93bmxvYWQiKQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwndmlkZW8nKSAKZWxpZiBtb2RlPT0yNDoKICAgIGFkZG9uX2xvZygiQXVkaW8gb25seSB5b3V0dWJlIGRvd25sb2FkIikKICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ2F1ZGlvJykKZWxpZiBtb2RlPT0yNToKICAgIGFkZG9uX2xvZygiWW91VHViZS9ETW90aW9uIikKICAgIHNlYXJjaCh1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCmVsaWYgbW9kZT09MjY6CiAgICBhZGRvbl9sb2coIllvdVR1YmUvRE1vdGlvbiBGcm9tIFNlYXJjaCBIaXN0b3J5IikKICAgIG5hbWUgPSBuYW1lLnNwbGl0KCc6JykKICAgIHNlYXJjaCh1cmwsc2VhcmNoX3Rlcm09bmFtZVsxXSkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlPT0yNzoKICAgIGFkZG9uX2xvZygiVXNpbmcgSU1EQiBpZCB0byBwbGF5IGluIFB1bHNhciIpCiAgICBwdWxzYXJJTURCPXNlYXJjaCh1cmwpCiAgICB4Ym1jLlBsYXllcigpLnBsYXkocHVsc2FySU1EQikgCmVsaWYgbW9kZT09MzA6CiAgICBHZXRTdWJsaW5rcyhuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0KQplbGlmIG1vZGU9PTMxOgogICAgV2l6SERNZW51KHVybCxpY29uaW1hZ2UsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTMyOgoJV2l6X0dldF91cmwodXJsKQoJeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQkKCQplbGlmIG1vZGU9PTQwOgogICAgU2VhcmNoQ2hhbm5lbHMoKQogICAgU2V0Vmlld1RodW1ibmFpbCgpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCmVsaWYgbW9kZSA9PSA0MSA6IAogICAgU2VhcmNoX2lucHV0KHVybCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCQplbGlmIG1vZGU9PTUzOgogICAgYWRkb25fbG9nKCJSZXF1ZXN0aW5nIEpTT04tUlBDIEl0ZW1zIikKICAgIHBsdWdpbnF1ZXJ5YnlKU09OKHVybCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSk=')
